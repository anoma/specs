<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Anoma Specification</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Index</a></li><li class="chapter-item expanded "><a href="motivation.html"><strong aria-hidden="true">2.</strong> Motivation</a></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">3.</strong> Architecture</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/namada.html"><strong aria-hidden="true">3.1.</strong> Namada</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/namada/consensus.html"><strong aria-hidden="true">3.1.1.</strong> Consensus</a></li><li class="chapter-item "><a href="architecture/namada/p2p.html"><strong aria-hidden="true">3.1.2.</strong> P2P layer</a></li><li class="chapter-item "><a href="architecture/namada/execution-system.html"><strong aria-hidden="true">3.1.3.</strong> Execution system</a></li><li class="chapter-item "><a href="architecture/namada/masp.html"><strong aria-hidden="true">3.1.4.</strong> Multi-asset shielded pool</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/namada/masp/trusted-setup.html"><strong aria-hidden="true">3.1.4.1.</strong> Trusted setup</a></li><li class="chapter-item "><a href="architecture/namada/masp/ledger-integration.html"><strong aria-hidden="true">3.1.4.2.</strong> Ledger integration</a></li><li class="chapter-item "><a href="architecture/namada/masp/shielded-pool-incentives.html"><strong aria-hidden="true">3.1.4.3.</strong> Shielded pool incentives</a></li></ol></li><li class="chapter-item "><a href="architecture/namada/governance.html"><strong aria-hidden="true">3.1.5.</strong> Governance</a></li><li class="chapter-item "><a href="architecture/namada/proof-of-stake.html"><strong aria-hidden="true">3.1.6.</strong> Proof of stake</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/namada/proof-of-stake/bonding-mechanism.html"><strong aria-hidden="true">3.1.6.1.</strong> Bonding mechanism</a></li><li class="chapter-item "><a href="architecture/namada/proof-of-stake/cubic-slashing.html"><strong aria-hidden="true">3.1.6.2.</strong> Cubic slashing</a></li><li class="chapter-item "><a href="architecture/namada/proof-of-stake/reward-distribution.html"><strong aria-hidden="true">3.1.6.3.</strong> Reward distribution</a></li></ol></li><li class="chapter-item "><a href="architecture/namada/inflation-system.html"><strong aria-hidden="true">3.1.7.</strong> Inflation system</a></li><li class="chapter-item "><a href="architecture/namada/fee-system.html"><strong aria-hidden="true">3.1.8.</strong> Fee system</a></li><li class="chapter-item "><a href="architecture/namada/ibc.html"><strong aria-hidden="true">3.1.9.</strong> IBC integration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/namada/ibc/message.html"><strong aria-hidden="true">3.1.9.1.</strong> Messages</a></li></ol></li><li class="chapter-item "><a href="architecture/namada/ethereum-bridge.html"><strong aria-hidden="true">3.1.10.</strong> Ethereum bridge</a></li><li class="chapter-item "><a href="architecture/namada/web-wallet-interface.html"><strong aria-hidden="true">3.1.11.</strong> Web wallet interface</a></li><li class="chapter-item "><a href="architecture/namada/web-explorer-interface.html"><strong aria-hidden="true">3.1.12.</strong> Web explorer interface</a></li><li class="chapter-item "><a href="architecture/namada/testnets.html"><strong aria-hidden="true">3.1.13.</strong> Testnets</a></li><li class="chapter-item "><a href="architecture/namada/external-integrations.html"><strong aria-hidden="true">3.1.14.</strong> External integrations</a></li></ol></li><li class="chapter-item "><a href="architecture/m2.html"><strong aria-hidden="true">3.2.</strong> M2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/m2/ferveo.html"><strong aria-hidden="true">3.2.1.</strong> Ferveo</a></li><li class="chapter-item "><a href="architecture/m2/private-bridges.html"><strong aria-hidden="true">3.2.2.</strong> Private bridges</a></li></ol></li><li class="chapter-item "><a href="architecture/a1.html"><strong aria-hidden="true">3.3.</strong> A1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/a1/state-architecture.html"><strong aria-hidden="true">3.3.1.</strong> State architecture</a></li><li class="chapter-item "><a href="architecture/a1/intent-gossip-system.html"><strong aria-hidden="true">3.3.2.</strong> Intent gossip system</a></li><li class="chapter-item "><a href="architecture/a1/matchmaking.html"><strong aria-hidden="true">3.3.3.</strong> Matchmaking</a></li><li class="chapter-item "><a href="architecture/a1/typhon.html"><strong aria-hidden="true">3.3.4.</strong> Typhon</a></li><li class="chapter-item "><a href="architecture/a1/private-bartering-circuits.html"><strong aria-hidden="true">3.3.5.</strong> Private bartering circuits</a></li><li class="chapter-item "><a href="architecture/a1/private-execution-architecture.html"><strong aria-hidden="true">3.3.6.</strong> Private execution architecture</a></li><li class="chapter-item "><a href="architecture/a1/decentralised-proof-of-identity.html"><strong aria-hidden="true">3.3.7.</strong> Decentralised proof-of-identity</a></li><li class="chapter-item "><a href="architecture/a1/public-goods-funding.html"><strong aria-hidden="true">3.3.8.</strong> Public goods funding</a></li><li class="chapter-item "><a href="architecture/a1/fee-system.html"><strong aria-hidden="true">3.3.9.</strong> Fee system</a></li></ol></li><li class="chapter-item "><a href="architecture/j1.html"><strong aria-hidden="true">3.4.</strong> J1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/j1/vampir/vampir.html"><strong aria-hidden="true">3.4.1.</strong> Vampir</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/j1/vampir/ir_design.html"><strong aria-hidden="true">3.4.1.1.</strong> Design Philosophy</a></li><li class="chapter-item "><a href="architecture/j1/vampir/ir_spec.html"><strong aria-hidden="true">3.4.1.2.</strong> Spec (Working Draft)</a></li><li class="chapter-item "><a href="architecture/j1/vampir/juvix-to-vampir.html"><strong aria-hidden="true">3.4.1.3.</strong> Juvix -&gt; Vampir Details</a></li><li class="chapter-item "><a href="architecture/j1/vampir/compilation_diagrams.html"><strong aria-hidden="true">3.4.1.4.</strong> Diagrams</a></li><li class="chapter-item "><a href="architecture/j1/vampir/examples.html"><strong aria-hidden="true">3.4.1.5.</strong> TestCircuit Example</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anoma Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="anoma"><a class="header" href="#anoma">Anoma</a></h1>
<p>Anoma is a suite of protocols and mechanisms for self-contained self-sovereign coordination.</p>
<ul>
<li><em>Coordination</em> means that Anoma concerns itself with actions requiring agreement and/or exchange between parties.</li>
<li><em>Self-sovereign</em> means that the Anoma protocol aims to foster alignment between users, operators, and developers.</li>
<li><em>Self-contained</em> means that the Anoma protocol should be alone sufficient for the technological part of this coordination.</li>
</ul>
<p>These documents describe the motivation, design rationale, architecture, and protocol details of Anoma. They are intended to be both <em>minimal</em>, in that no more is said than necessary, and <em>complete</em>, in that enough is said to define precisely what Anoma is. Anoma is a protocol, it is not an implementation. Documentation for the implementation of the Anoma protocol by Heliax can be found <a href="https://docs.anoma.network/v0.4.0/">here</a>.</p>
<p>Anoma is free, in both the senses of &quot;free speech&quot; and &quot;free beer&quot;. The source for these documents is <a href="https://github.com/anoma/spec">on Github</a>, permissively licensed, and they can be forked or edited as you like. At present, this particular repository is stewarded by the <a href="https://anoma.foundation/">Anoma Foundation</a>. Contributions are welcome.</p>
<p>This specification is designed be readable in both breadth-first and depth-first manners. If you want to understand the broad motivation and architecture of Anoma, read the <a href="./motivation.html">motivation</a> and <a href="./architecture.html">architecture</a> overviews. If you want to dive into the protocol details of a particular aspect of Anoma, such as the <a href="./architecture/a1/state-architecture.html">state architecture</a>, or release, such as <a href="./architecture/namada.html">Namada</a>, you can start directly with the document in question; overview documents are self-contained and/or crosslinked where necessary, and contain pointers to subprotocols and details thereof. A sitewide search function is available at the upper left.</p>
<blockquote>
<p><strong>NOTE:</strong> These documents are not yet complete. If you're reading this page right now, there's a high chance you might be interested in the <a href="./architecture/namada.html">Namada specification</a>.</p>
</blockquote>
<p>Happy reading!</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="motivation"><a class="header" href="#motivation">Motivation</a></h1>
<p>For now, see <a href="https://anoma.network/papers/vision-paper.pdf">the Anoma vision paper</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>The Anoma protocol suite is being designed and architected in progressive stages, each building upon the previous.</p>
<p>The first and most complete stage is <a href="./architecture/namada.html">Namada</a>. Design work is already progressing on <a href="./architecture/m2.html">M2</a>, <a href="./architecture/a1.html">A1</a>, and <a href="./architecture/j1.html">J1</a> in parallel.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="m1-overview"><a class="header" href="#m1-overview">M1 Overview</a></h1>
<p>M1 is a sovereign proof-of-stake blockchain, using Tendermint BFT consensus,
that enables multi-asset private transfers for any native or non-native asset
using a multi-asset shielded pool derived from the Sapling circuit. M1 features
full IBC protocol support, a natively integrated Ethereum bridge, and simple governance.
A multi-asset shielded transfer wallet is provided in order to facilitate
safe and private user interaction with the protocol.</p>
<p>Over time the set of supported features may be extended to include
features such as fully programmable validity predicates, distributed
key generation &amp; threshold decryption for Ferveo, and more advanced
ZKP circuits. See <a href="architecture/./m2.html">M2</a>.</p>
<h2 id="raison-dêtre"><a class="header" href="#raison-dêtre">Raison d'être</a></h2>
<p>Safe and user-friendly multi-asset privacy doesn't yet exist in the blockchain ecosystem. Up until now you
had the choice to build a sovereign chain that reissues assets (e.g. Zcash) or to
build a privacy preserving solution on existing chains (e.g. Tornado Cash on
Ethereum). Both have large trade-offs: in the former case users don't have
assets that they actually want to use and in the latter case the restrictions
of existing platforms mean that users leak a ton of metadata
and the protocols are expensive and clunky to use.</p>
<p>M1 can support any asset on an IBC-compatible blockchain,
and assets sent over a custom Ethereum bridge that will
reduce transfer costs and streamline UX as much as possible.
Once assets are on M1, shielded transfers will be cheap
and all assets contribute to the same anonymity set.</p>
<p>M1 is also a helpful stepping stone to finalise, test,
and launch a protocol version that is simpler than the full
Anoma protocol but still encapsulates a unified and useful
set of features. There are reasons to expect that it may
make sense for a fractal instance focused exclusively on
shielded transfers to exist in the long-term, as it can
provide throughput and user-friendliness guarantees which
are more difficult to provide with a more general platform.
M1 is designed so that it could evolve into such an instance.</p>
<h1 id="features"><a class="header" href="#features">Features</a></h1>
<h2 id="base-ledger"><a class="header" href="#base-ledger">Base Ledger</a></h2>
<ul>
<li><a href="architecture/m1/consensus.html">Consensus</a></li>
<li><a href="architecture/m1/p2p-layer.html">P2P layer</a></li>
<li><a href="architecture/m1/execution-system.html">Execution system</a></li>
<li><a href="architecture/m1/governance.html">Governance</a></li>
<li><a href="architecture/m1/proof-of-stake.html">Proof-of-stake</a></li>
</ul>
<h2 id="cryptography"><a class="header" href="#cryptography">Cryptography</a></h2>
<ul>
<li><a href="architecture/m1/masp.html">Multi-asset shielded pool circuit</a></li>
</ul>
<h2 id="interoperability"><a class="header" href="#interoperability">Interoperability</a></h2>
<ul>
<li><a href="architecture/m1/ibc.html">IBC integration</a></li>
<li><a href="architecture/m1/ethereum-bridge.html">Bidirectional Ethereum bridge</a></li>
</ul>
<h2 id="economics"><a class="header" href="#economics">Economics</a></h2>
<ul>
<li><a href="architecture/m1/masp/shielded-pool-incentives.html">Shielded pool incentives</a></li>
<li><a href="architecture/m1/proof-of-stake/reward-distribution.html">Proof-of-stake reward distribution</a></li>
<li><a href="architecture/m1/proof-of-stake/cubic-slashing.html">Cubic slashing</a></li>
<li><a href="architecture/m1/inflation-system.html">Inflation system</a></li>
<li><a href="architecture/m1/fee-system.html">Fee system</a></li>
</ul>
<h2 id="user-interfaces"><a class="header" href="#user-interfaces">User interfaces</a></h2>
<ul>
<li><a href="architecture/m1/web-wallet-interface.html">Web-based wallet</a></li>
<li><a href="architecture/m1/web-explorer-interface.html">Web-based block explorer</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="consensus"><a class="header" href="#consensus">Consensus</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="p2p-layer"><a class="header" href="#p2p-layer">P2P layer</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="execution-system"><a class="header" href="#execution-system">Execution system</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="multi-asset-shielded-pool"><a class="header" href="#multi-asset-shielded-pool">Multi-asset shielded pool</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="trusted-setup"><a class="header" href="#trusted-setup">Trusted setup</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ledger-integration"><a class="header" href="#ledger-integration">Ledger integration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="shielded-pool-incentives"><a class="header" href="#shielded-pool-incentives">Shielded pool incentives</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="governance"><a class="header" href="#governance">Governance</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="proof-of-stake"><a class="header" href="#proof-of-stake">Proof of stake</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="bonding-mechanism"><a class="header" href="#bonding-mechanism">Bonding mechanism</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="cubic-slashing"><a class="header" href="#cubic-slashing">Cubic slashing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="reward-distribution"><a class="header" href="#reward-distribution">Reward distribution</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="inflation-system"><a class="header" href="#inflation-system">Inflation system</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="fee-system"><a class="header" href="#fee-system">Fee system</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ibc-integration"><a class="header" href="#ibc-integration">IBC integration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="messages"><a class="header" href="#messages">Messages</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ethereum-bridge"><a class="header" href="#ethereum-bridge">Ethereum bridge</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="web-wallet-interface"><a class="header" href="#web-wallet-interface">Web wallet interface</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="web-explorer-interface"><a class="header" href="#web-explorer-interface">Web explorer interface</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="testnets"><a class="header" href="#testnets">Testnets</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="external-integrations"><a class="header" href="#external-integrations">External integrations</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="m2"><a class="header" href="#m2">M2</a></h1>
<p>See <a href="architecture/./m2/ferveo.html">Ferveo</a> and <a href="architecture/./m2/private-bridges.html">private bridges</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ferveo"><a class="header" href="#ferveo">Ferveo</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="private-bridges"><a class="header" href="#private-bridges">Private bridges</a></h1>
<p>For now, see <a href="https://hackmd.io/cob1x80xSuecMtwmbCPvVA">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="a1"><a class="header" href="#a1">A1</a></h1>
<p>A1 is the initial version of the full Anoma architecture.</p>
<ul>
<li><a href="architecture/./a1/state-architecture.html">State architecture</a></li>
<li><a href="architecture/./a1/intent-gossip-system.html">Intent gossip system</a></li>
<li><a href="architecture/./a1/matchmaking.html">Matchmaking</a></li>
<li><a href="architecture/./a1/typhon.html">Typhon</a></li>
<li><a href="architecture/./a1/private-bartering-circuits.html">Private bartering circuits</a></li>
<li><a href="architecture/./a1/private-execution-architecture.html">Private execution architecture</a></li>
<li><a href="architecture/./a1/decentralised-proof-of-identity.html">Decentralised proof-of-identity</a></li>
<li><a href="architecture/./a1/public-goods-funding.html">Public goods funding</a></li>
<li><a href="architecture/./a1/fee-system.html">Fee system</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="state-architecture"><a class="header" href="#state-architecture">State architecture</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="intent-gossip-system"><a class="header" href="#intent-gossip-system">Intent gossip system</a></h1>
<ul>
<li>Planning board: <a href="https://github.com/orgs/anoma/projects/1/views/9">https://github.com/orgs/anoma/projects/1/views/9</a></li>
<li>Docs book: <a href="https://docs.anoma.network/master/explore/design/gossip.html">https://docs.anoma.network/master/explore/design/gossip.html</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="matchmaking"><a class="header" href="#matchmaking">Matchmaking</a></h1>
<ul>
<li>Planning board: <a href="https://github.com/orgs/anoma/projects/1/views/11">https://github.com/orgs/anoma/projects/1/views/11</a></li>
<li>Docs book: <a href="https://docs.anoma.network/master/explore/design/intent_gossip/matchmaker.html">https://docs.anoma.network/master/explore/design/intent_gossip/matchmaker.html</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="typhon"><a class="header" href="#typhon">Typhon</a></h1>
<h2 id="consensus-mechanism"><a class="header" href="#consensus-mechanism">Consensus Mechanism</a></h2>
<h2 id="chimera-chains"><a class="header" href="#chimera-chains">Chimera Chains</a></h2>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>This specification intends to describe how heteregenous Paxos can be realized in the blockchain context. Given well-defined quorums, the protocol allows a known set <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>   <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> of chains to construct and  carry out atomic transactions on a so-called <em>chimera chain</em>, subject to certain conditions.  The chimera chain guarantees safety and liveness subject to the usual assumption: at most a third of the stake belongs to Byzantine participants. </p>
<p>The protocol involves three kinds of agents: proposers, acceptors and learners. A node may play the role of any combination of the three kinds of agents. </p>
<p>Blocks are agreed upon in rounds. </p>
<p><strong>Proposer</strong> initate a round by a  proposing a block. Each block contains atomic batches of transactions (or even a single transaction). An atomic batch of transactions means that either all transactions in the batch are executed or none of them are executed.</p>
<p><strong>Acceptors</strong> are agents who agree on the proposed blocks and an agent may be acceptor for more than one chain. No correct acceptor acts on any invalid block. This requires checking the validation of blocks or state transition function. </p>
<p><strong>Learners</strong> are set of agents where this set is intrested in a particualar (combination of?) chain(s) meaning what the voting process decides for these chain(s). The definition of learners is based on the quorums and defined by the protocol, meaning that agents are not free not choose their own quorum setups. <!--For example, there might be three well-defined learners <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> which are agents who are interetsted in chain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> alone, chain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> alone, and both chain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> chain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>.--> Acceptors need to be aware of the different definitions of learners in order to be able to know what correct behavior is defined as. This set of the agents for learners, might empty or have overlaps, the acceptors have to follow the deifnition regardless. <!--Acceptor of chain are considered also part of learners of that chain.--></p>
<p>We briefly describe how the communication for a consensus round works. Suppose we have two learners <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> which refer to agents that are interested in blockchain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> and blockchain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>. Proposers propose a chimera block, by sending <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> messages, each carrying a value and unique ballot number (round identifier), to acceptors. All acceptors in all involved chains (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>) send <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> messages to each other to communicate that they’ve received a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> message. When an acceptor receives a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message for the highest ballot number it has seen from a learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>’s quorum of acceptors, it sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message labeled with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and that ballot number. There is one exception: once a safe acceptor sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> for a learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, it never sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message with a different value for a learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>, unless one of the following is true: </p>
<ul>
<li>It knows that a quorum of acceptors has seen <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages with learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and ballot number higher than <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>. </li>
<li>It has seen Byzantine behavior that proves <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> do not have to agree. </li>
</ul>
<p>A learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> decides on a block when it receives <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages with the same proposed block and ballot number from one of its quorums of acceptors.</p>
<h2 id="preliminaries"><a class="header" href="#preliminaries">Preliminaries</a></h2>
<ul>
<li><em>Base chains</em> are two or more independent chains between which we would like to carry out atomic transactions. The chains must protocol-wise adhere to some  specific set of requirements to be compatible. For example, IBC support.</li>
</ul>
<!-- These chains are programmed with chimera chains in mind: for example, they may all be Anoma chains. -->
<ul>
<li>
<p>A <em>chimera chain</em> is a chain that allows atomic transactions to be carried out on <a href="https://en.wikipedia.org/wiki/Object_(computer_science)">objects</a> from the base chains. It carries an additional consensus mechanism, that is dependent on the consensus of the base chains. </p>
</li>
<li>
<p>A <em>learner</em> is a client that is interested in the value decided by the voting process. Learners might be full nodes, light client nodes, or nodes from other chains.</p>
</li>
<li>
<p>An <em>acceptor</em> is an agent participating in the voting process of the consensus protocol. Non-byzantine acceptors are called <em>real</em> acceptors. </p>
</li>
</ul>
<!--We denote a set of acceptors by `Acceptor`.-->
<ul>
<li>
<p>A <em>quorum</em> is a subset of acceptors sufficient to make a learner decide on a value. For a learner to maintain consistency (avoid deciding on two contradictory values), any two of its quorums must have a common real acceptor. Most chains achieve this practically by making the intersection of the quorums big enough, i.e. the acceptors in the intersection being backed by more than &gt;1/3 stake of each chain under &lt;1/3 Byzantine assumption. For example, suppose:</p>
<ul>
<li>Base chain A has a total stake of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">60</span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span>.</li>
<li>Base chain B has a total stake of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">300</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span>.</li>
<li>Any set of acceptors backed by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">40</span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span> is a quorum of chain A. This means <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">20</span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span> would have to back unsafe acceptors for chain A to fork.</li>
<li>Any set of acceptors backed by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">200</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span> is a quorum of chain B. This means <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">100</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span> woudl have to back unsafe acceptors for chain B to fork.</li>
<li>Suppose that, for every quorum <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> of chain A, and every quorum <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> of chain B, the acceptors in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.75em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are backed by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">10</span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span>, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">50</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span>. This would mean that, in order for atomic batches on the chimera chain to lose atomicity, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">10</span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">50</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03148em;">ak</span><span class="mord mathnormal">e</span></span></span></span> would have to back unsafe acceptors.
<ul>
<li>When a batch loses atomicity, the transactions on one state machine (say, A) are executed, but not the transactions on the other state machine (say, B). However, each state machine itself remains consistent: neither A nor B forks.</li>
<li>This means some chimera chains offer atomicity with lower (yet well-defined) levels of integrity than their base chains' no-fork guarantees.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>A <em>proposer</em> is an acceptor that may propose a new block according to the rules of the blockchain. A potential proposer would need (a) data availability, (b) the ability to sign messages, ( c) something at stake (to prevent spam) and (d) the ability to communicate with the acceptors. Acceptors that are in the overlaps of quorums may especially well suited to be proposers, but other Acceptors (or even other machines) might be proposers as well.
The Heterogeneous Paxos technical report effectively uses weighted voting for select proposer, but perhaps there are interesting tricks with VRFs that would improve efficiency. </p>
</li>
</ul>
<h3 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h3>
<ol>
<li><strong>Acceptors are staked</strong>:  An acceptor has a certain amount of stake backing them. This stake is either fully their own stake or is partly delegated to them by other token holders.</li>
<li><strong>Quorums are known</strong>: Quorums are defined implicitly by the internal logic of each chain. For most proof-of-stake chains, a quorum is a subset of acceptor that have <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> of stake backing them. </li>
<li><strong>Large Overlap of Quorums</strong>: A practical way to ensure a safe acceptors in the overlap between quorums. To guarantee atomicity with the same integrity as base chains, each quorum overlap must be backed by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> of the stake of each base chain.</li>
<li><strong>Connectivity</strong>: All acceptors in a chimera chain communicate with each other (even if that means talking to acceptors who are not on the same base chain). This communication <em>can</em> be indirect (i.e. gossiping through other acceptors), so long as all pairs of honest acceptors can always communicate.</li>
<li><strong>Only one learner per main chain</strong>: We model the learner graph as one learner per main chain, and then full nodes can instantiate their base chain's learner to make decisions. The reason is that in Heterogeneous Paxos the learner graph is a closed graph with known nodes, while in the blockchain context we have a open network where we don't know who all the learners are. </li>
</ol>
<!--
Formally,
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">∀</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord">.∃</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">cce</span><span class="mord mathnormal">pt</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord">.</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.75em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.75em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span></span>
-->
<h2 id="chimera-chain"><a class="header" href="#chimera-chain">Chimera Chain</a></h2>
<p>In this section we describe how chimera chains operate. </p>
<p>Upon wanting to include an atomic batch of transactions from the transaction pool into a block, a block proposer either creates a genesis block if there is no existing chimera chain or builds on top of an existing chimera chain. </p>
<h3 id="genesis-block"><a class="header" href="#genesis-block">Genesis block</a></h3>
<p>In order to be safe, the guarantee we want here is that future quorum updates on the main chains are guaranteed to be received before voting happens on chimera chains. </p>
<ol>
<li>Create a genesis block that claims to be a &quot;chimera chain&quot; and allocate some unique name or index.</li>
<li>Register (in a transaction) that genesis block on all base chains and allocate it some unique name, so they know to involve it in any future quorum updates. The guarantee we want here is that future quorum updates are guaranteed to be received before votes happen.</li>
<li>The first block append on the chimera chain requires IBC messages from all base chains explaining that they have registered this genesis block.</li>
</ol>
<h3 id="producing-blocks"><a class="header" href="#producing-blocks">Producing Blocks</a></h3>
<p>The block consists of transactions from both chains or just on of the chains. The transaction can be bundled together to make sure they are carried out atomically. </p>
<p>It is possible that more than one block may be finalized like in Grandpa (from Polkadot project) decoupling block prduction from finalization. In thi scase, Heterogeneous Paxos would serve the roll of a &quot;finality gadget&quot; in Grandpa's terms, but blocks could be produced at any rate. </p>
<h4 id="moving-objects"><a class="header" href="#moving-objects">Moving Objects</a></h4>
<!--A higher-level programming concept that might be more useful.-->
<p>Suppose state in each state machine is expressed in terms of objects (think object-oriented programming) with state and methods, and a location (each is located on a chain).  Our ideas about &quot;movable objects&quot; should be applicable to any program entities which feature:</p>
<ul>
<li>a unique identifier</li>
<li>a permanent set of public methods (an API) callable by users, or other methods on other objects in the same state machine, which can compute and return values</li>
<li>a set of private methods callable only by other methods on this object</li>
<li>mutable state (which only methods can mutate)</li>
</ul>
<p>These are much like &quot;smart contracts,&quot; which also carry internal mutable state and public APIs much like methods. An example of an &quot;object&quot; is any sort of account: multisignature account or single user account:</p>
<ul>
<li>accounts usually have a unique identifier </li>
<li>public methods include &quot;send money,&quot; which takes as input some signed authorization and deducts money from the account.</li>
<li>mutable state includes some value representing the amount of money in the account.</li>
</ul>
<p>One might want to move an object to another state machine. For simplicity, let's suppose it's a state machine with the same quorums (on a different, possibly chimera, chain). This is not so very different from various chains trying to get a lock on an account (objects) and then perform atomic operations on them.</p>
<p>This &quot;move&quot; operation should require an IBC send, and then deleting the original object. Or instead of deleting the original object the original object can be made a <em>pointer</em> to the object which now lives primarily on the destination chain. On the destination state machine, an IBC receive should be followed by creating a new copy of the object. Any &quot;object identifiers&quot; found in pointers from other objects will have to be preserved, which could be tricky.</p>
<!--
To implement moving objects in practice, the object can be locked on original chain upon being moved and only unlocked once it is moved back, when it can be updated. -->
<h5 id="permissions-for-moving-objects"><a class="header" href="#permissions-for-moving-objects">Permissions for moving Objects</a></h5>
<p>We have to consider who is allowed to move which objects where. One way to do this is to have &quot;move&quot; simply be a &quot;private method&quot; of any object: the programmer has to specifically program in any methods that the transactions or other objects can call to move the object. The most straightforward private method definition would allow anyone (e.g.,owners) who can control the object be able to give permission for moving. <!--While they can also define the private method to give this permission to any other object they control (e.g., smart contract). --></p>
<p>We may want to allow chains to specify limits on what objects can move onto that chain. For example, they may require that objects have a method that can move them back to a base chain.</p>
<!--This could get messy fast.-->
<!--Another possibility is to have each object specify its required safety and liveness properties, and then check with each move that these are preserved. This too could get messy. We may end up doing Information Flow Control.-->
<h2 id="epoch-change"><a class="header" href="#epoch-change">Epoch Change</a></h2>
<!--What happens when a main chain updates its quorums (moves to a new epoch)? 

How is updating done?-->
<p>If new quorums for each base chain do not overlap on a real acceptor, atomicity cannot be guaranteed. We can no longer meaningfully commit atomic batches to the chimera chain. However, extensions to the chimera chain are consistent from the point of view of each base chain (but different base chains may &quot;perceive&quot; different extensions). This allows us to, for example, move objects to base chains even after the chimera chain loses atomic guarantees.</p>
<h2 id="kill-chains"><a class="header" href="#kill-chains">Kill Chains</a></h2>
<p>Likewise, it's probably useful to kill chimera chains no one is using anymore. If we don't kill them, when quorums change all of chimera chains need to get an update, and that can become infeasible. One possibility is to allow chains with no objects on them (everything has moved out) to execute a special &quot;kill&quot; transaction that prohibits any future transactions, and sends an IBC message to all parent chains. On receipt, parent chains could remove that chimera chain from their registry.</p>
<h2 id="protocol-description"><a class="header" href="#protocol-description">Protocol Description</a></h2>
<p>This section describes how a chimera block is appended to the existing chimera chain assuming all the setup has taken place. </p>
<p>For simplicity, this protocol is written as if we're deciding on one thing: the specific block that belongs on a specific blockchain at a specific height. All state and references are specific to this blockchain / height pair. We do not care about messages before this height. This height may be defined using the last finalized block in the blockchain. </p>
<h3 id="learner-graph"><a class="header" href="#learner-graph">Learner Graph</a></h3>
<p>For each learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span>, we call its set of quorums <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord" style="color:#df0030;"><span class="mord mathnormal" style="color:#df0030;">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#df0030;"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p>For each pair of learners <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span>, there are a specific set of conditions under which they require agreement. We enumerate these as <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span></span></span></span>, a set of &quot;safe sets&quot; of acceptors: whenever at least one set in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span></span></span></span> is composed entirely of safe (non-byzantine, but possibly crashed) acceptors, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span> must not decide different things. </p>
<p>We designate the set of acceptors who are actually safe <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="mord"><span class="mspace"> </span></span></span></span></span>. This is of course determined at runtime, and unknown to anyone.</p>
<h3 id="messages-1"><a class="header" href="#messages-1">Messages</a></h3>
<p>The protocol is carried out by sending and receiving messsages. The table below describes the structure of a typical heteregenous paxos message. </p>
<table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>chainId</td><td><code>Id</code></td><td>Identifies this Chimera Chain</td></tr>
<tr><td>height</td><td><code>uint64</code></td><td>Current height of the chimera chain</td></tr>
<tr><td>pktType</td><td><code>enum PktType {1A, 1B, 2A}</code></td><td></td></tr>
<tr><td>ballot</td><td><code>Ballot</code> = <code>(Timestamp, Hash)</code></td><td>This consists of the hash of the proposed block and the timestamp of the initiated ballot. There is a total lexicographical order on <code>Ballot</code>.</td></tr>
<tr><td>learner</td><td><code>Id</code></td><td></td></tr>
<tr><td>sig</td><td><code>Sig</code></td><td>The signature field <code>sig</code> unforgeably identifying its sender, e.g., the message is signed, and the sender has a known PK in some PKI.</td></tr>
<tr><td>refs</td><td><code>Vec&lt;Hash&gt;</code></td><td>The list of hashes of messages received previously.</td></tr>
</tbody></table>
<p>In general, acceptor relay all sent or received messages to all learners and other acceptors. This ensures that any message received by a real acceptor is received by all real acceptors and learners.</p>
<h4 id="definition-message-signer"><a class="header" href="#definition-message-signer">Definition: Message Signer</a></h4>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">ess</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textrm">the acceptor or proposer that signed </span></span><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span></span></p>
<h4 id="definition-message-set-signers"><a class="header" href="#definition-message-set-signers">Definition: Message Set Signers</a></h4>
<p>We can define <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span> over sets of messages, to mean the set of signers of those messages:
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">se</span><span class="mord mathnormal">t</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">{</span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:1.2em;border-right-width:0.04em;border-right-style:solid;margin:0 -0.02em;vertical-align:-0.35em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">}</span></span></span></span></span></span></span></span></p>
<p>Messages also contain a field <code>refs</code>, which includes chained hashes of every message the sender has sent or received since (and including) the last message it sent. As a result, we can define the transitive references of a message, which should include every message the sender has ever sent or received:</p>
<h4 id="definition-transitive-references"><a class="header" href="#definition-transitive-references">Definition: Transitive References</a></h4>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">}</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4882em;vertical-align:-1.4382em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:#6495ed;">m</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="color:#28ae7b;">x</span><span class="mord mtight" style="color:#28ae7b;">.</span><span class="mord mtight" style="color:#28ae7b;"><span class="mord mathit mtight" style="color:#28ae7b;">refs</span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">⋃</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4382em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></p>
<p>To ensure that acceptors and learners <em>fully understand</em> each message they receive, they delay doing any computation on it (sometimes called delivery) until they have received all the messages in <code>refs</code>. As a result, acceptors and learners will always process messages from any given sender in the order they were sent, but also from any messages that sender received, and recursively.</p>
<!-- ### Protocol Description

1. **Propose a block**: A proposer proposes a new block that the acceptor will vote on by sending a message containing the hash of the proposed block along with a time stamp of the ballot initiation. This message is called _1a-message_. If there is an existing chimera chain the proposer can built upon that chain and if the proposer is starting a new chimera chain it needs to lock some funds for that. 
 
<!-- The block consists of transactions from both chains or just on of the chains. The transaction can be bundled together to make sure they are carried out atomically. 

more than one block be finalized like in Grandpa? and decoupling block prduction from finalization
    - In principle, yes. Heterogeneous Paxos would serve the roll of a "finality gadget" in Grandpa's terms, but blocks could be produced at any rate

-->
<h3 id="consensus-round-ballot"><a class="header" href="#consensus-round-ballot"><strong>Consensus Round: Ballot</strong></a></h3>
<p>Next, we briefly describe how the communication for a consensus round works. Consensus is reached in four steps: proposing the chimera block, acknowledging receipt of proposals,  establishing consensus, and termination.</p>
<p>Suppose we have two learners <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> from two different blockchains. </p>
<h4 id="1a-message-proposing-blocks"><a class="header" href="#1a-message-proposing-blocks"><strong><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> message: proposing blocks</strong></a></h4>
<!--To propose a chimera block, proposers send <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> messages, each carrying a value (the atomic transaction for example) and unique ballot number (round identifier), to all acceptors. -->
<p>A proposer proposes a new block by sending a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> message to all acceptors, which includes </p>
<ul>
<li>a value (the atomic transaction for example)</li>
<li>a unique ballot number (round identifier)</li>
<li>a message containing the hash of the proposed block along with a time stamp of the ballot initiation. </li>
</ul>
<p>If there is an existing chimera chain, the proposer can built upon that chain and if the proposer is starting a new chimera chain it needs to lock some funds for that.</p>
<p>Also, the acceptor needs to check validity as soon as possible: don't even &quot;receive&quot; an invalid proposal (or at least don't send a &quot;1b&quot; message in response).</p>
<h4 id="1b-message-acknowledging-receiving-proposals"><a class="header" href="#1b-message-acknowledging-receiving-proposals"><strong><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message: acknowledging receiving proposals</strong></a></h4>
<p>On receipt of a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> message, an acceptor sends an ackowledgement of its receipt to all other acceptors and learners in the form of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message.</p>
<h4 id="2a-message-establishing-consensus"><a class="header" href="#2a-message-establishing-consensus"><strong><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message: establishing consensus</strong></a></h4>
<p>When an acceptor receives a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message for the highest ballot number it has seen from a learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>’s quorum of acceptors, it sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message labeled with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and that ballot number.</p>
<p>There is one exception: once a safe acceptor sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> for a learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, it never sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message with a different value for a learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, unless one of the following is true: </p>
<ul>
<li>It knows that a quorum of acceptors has seen <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages with learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and ballot number higher than <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>. </li>
<li>It has seen Byzantine behavior that proves <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> do not have to agree. </li>
</ul>
<h5 id="specifics-of-establishing-consensus"><a class="header" href="#specifics-of-establishing-consensus">Specifics of establishing Consensus</a></h5>
<p>In order to make a learner decide, we need to show that another, <em>Entangled</em> learner could not already have decided.</p>
<h5 id="definition-entangled"><a class="header" href="#definition-entangled">Definition: Entangled</a></h5>
<p>In an execution, two learners are <em>entangled</em> if their failure assumptions matched the failures that actually happen:
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord textrm">Entangled</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="mord"><span class="mspace"> </span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span></span></span></span></span></p>
<p>If some learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> does not agree with some other learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> cannot possibly agree with both <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<h5 id="definition-heterogeneous-agreement"><a class="header" href="#definition-heterogeneous-agreement">Definition: Heterogeneous Agreement</a></h5>
<ul>
<li>Within an execution, two learners have <em>agreement</em> if all decisions for either learner have the same value.</li>
<li>A heterogeneous consensus protocol has <em>agreement</em> if, for all possible executions of that protocol, all entangled pairs of learners have agreement.</li>
</ul>
<h5 id="definition-accurate-learner"><a class="header" href="#definition-accurate-learner">Definition: Accurate Learner</a></h5>
<p>An accurate learner is entangled with itself:
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord textrm">Accurate</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord textrm">Entangled</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></p>
<p>A learner whose quorums contain too many failures is inaccurate. This is the equivalent of a chain that can fork. </p>
<p>In order to prevent entangled disagreement, we must define the conditions that will ultimately make learners decide:</p>
<h5 id="definition-get1a"><a class="header" href="#definition-get1a">Definition: Get1a</a></h5>
<p>It is useful to refer to the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> that started the ballot of a message: the highest ballot number <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> in its transitive references.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Get1a</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8549em;vertical-align:-1.1604em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4306em;"><span style="top:-2.1146em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:#6495ed;">m</span><span class="mrel mtight">:</span><span class="mord text mtight"><span class="mord textit mtight">1a</span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textrm mtight">Tran</span></span><span class="mord mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">(</span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:#28ae7b;">x</span></span></span><span class="mclose mtight delimcenter" style="top:0em;"><span class="mtight">)</span></span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mord mathrm" style="margin-right:0.01389em;">arg</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1604em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="mord" style="color:#6495ed;">.</span><span class="mord mathnormal" style="color:#6495ed;">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#6495ed;">ll</span><span class="mord mathnormal" style="color:#6495ed;">o</span><span class="mord mathnormal" style="color:#6495ed;">t</span></span></span></span></span></span></p>
<h5 id="definition-ballot-numbers"><a class="header" href="#definition-ballot-numbers">Definition: Ballot Numbers</a></h5>
<p>The ballot number of a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> is part of the message, and the ballot number of anything else is the highest ballot number among the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span>s it (transitively) references.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Get1a</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span></span></span></span></span></p>
<h5 id="definition-value-of-a-message"><a class="header" href="#definition-value-of-a-message">Definition: Value of a Message</a></h5>
<p>The value of a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> is part of the message, and the value of anything else is the value of the highest ballot <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span>  among the messages it (transitively) references.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">V</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Get1a</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span></span></p>
<h4 id="terminate-finalizing-blocks"><a class="header" href="#terminate-finalizing-blocks"><strong>Terminate: Finalizing blocks</strong></a></h4>
<p>A learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> decides when it receives <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages with the same ballot number from one of its quorums of acceptors.</p>
<p>If no decision can be reached within a certain time, proposers must begin a new round (with a higher timestamp, and thus a higher Ballot). Proposers can start a new round by proposing a new block or by trying to finalize the same block again (in case there was no consensus).</p>
<h5 id="definition-decision"><a class="header" href="#definition-decision">Definition: Decision</a></h5>
<p>A learner decides when it has observed a set of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages with the same ballot, sent by a quorum of acceptors. This will allow the learner to <em>decide</em> on the value of the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages in the set. We call such a set a <em>decision</em>:
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Decision</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord" style="color:#df0030;"><span class="mord mathnormal" style="margin-right:0.03588em;color:#df0030;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#df0030;"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord" style="color:#df0030;"><span class="mord mathnormal" style="margin-right:0.03588em;color:#df0030;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#df0030;"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord" style="color:#df0030;"><span class="mord mathnormal" style="color:#df0030;">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#df0030;"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∀</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;color:#6495ed;">y</span></span></span><span class="mclose delimcenter" style="top:0em;">}</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mord" style="color:#df0030;"><span class="mord mathnormal" style="margin-right:0.03588em;color:#df0030;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#df0030;"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">.</span><span class="mspace"> </span><span class="mord"><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='0.016em' style='width:0.875em' viewBox='0 0 875 16' preserveAspectRatio='xMinYMin'><path d='M291 0 H417 V16 H291z M291 0 H417 V16 H291z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;color:#6495ed;">y</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mord" style="color:#28ae7b;">.</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#28ae7b;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#28ae7b;">r</span><span class="mord mathnormal" style="color:#28ae7b;">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">2a</span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='0.016em' style='width:0.875em' viewBox='0 0 875 16' preserveAspectRatio='xMinYMin'><path d='M457 0 H583 V16 H457z M457 0 H583 V16 H457z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>Now we are ready to discuss what makes a <em>Well-Formed</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message. This requires considering whethern two learners might be entangled, and (unless we can prove they are not engangled), whether one of them might have already decided:</p>
<h5 id="definition-caught"><a class="header" href="#definition-caught">Definition: Caught</a></h5>
<p>Some behavior can create proof that an acceptor is Byzantine. Unlike Byzantine Paxos, our acceptors and learners must adapt to Byzantine behavior.  We say that an acceptor <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="color:#9d38bd;">p</span></span></span></span> is <em>Caught</em> in a message <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span> if the transitive references of the messages include evidence such as two messages, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">m</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord" style="color:#6495ed;"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#6495ed;"><span class="mord mtight" style="color:#6495ed;">′</span></span></span></span></span></span></span></span></span></span></span>, both signed by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="color:#9d38bd;">p</span></span></span></span>, in which neither is featured in the other's transitive references (safe acceptors transitively reference all prior messages).</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Caught</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-1.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.892em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-4.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:4.8em;border-right-width:0.04em;border-right-style:solid;margin:0 -0.02em;vertical-align:-2.15em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:4.65em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord" style="color:#6495ed;"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#6495ed;"><span class="mord mtight" style="color:#6495ed;">′</span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">}</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord" style="color:#6495ed;"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#6495ed;"><span class="mord mtight" style="color:#6495ed;">′</span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord" style="color:#6495ed;"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#6495ed;"><span class="mord mtight" style="color:#6495ed;">′</span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord" style="color:#6495ed;"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#6495ed;"><span class="mord mtight" style="color:#6495ed;">′</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-1.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎭</span></span></span><span style="top:-1.892em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎬</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-4.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎫</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><strong>Slashing</strong>: Caught proofs can be used for slashing. </p>
<h5 id="definition-connected"><a class="header" href="#definition-connected">Definition: Connected</a></h5>
<p>When some acceptors are proved \byzantine, clearly some learners need not agree, meaning that <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.075em;">S</span></span><span class="mord"><span class="mspace"> </span></span></span></span></span> isn't in the edge between them in the CLG: at least one acceptor in each safe set in the edge is proven Byzantine. Homogeneous learners are always connected unless there are so many failures no consensus is required.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Con</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">{</span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:2.4em;border-right-width:0.04em;border-right-style:solid;margin:0 -0.02em;vertical-align:-0.95em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#9d38bd;">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord text"><span class="mord textrm">CLG</span></span></span><span class="mord"><span class="mspace"> </span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#9d38bd;">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Caught</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">∅</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">}</span></span></span></span></span></span></span></span></p>
<h5 id="definition-quorums-in-messages"><a class="header" href="#definition-quorums-in-messages">Definition: Quorums in Messages</a></h5>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages reference <em>quorums of messages</em> with the same  value and ballot. A <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span>'s quorums are formed from <a href="architecture/a1/typhon.html#Definition-Fresh">fresh</a> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> messages with the same ballot and value.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">q</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">2a</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:5.2096em;vertical-align:-2.3548em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-1.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.892em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-4.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8548em;"><span style="top:-4.8548em;"><span class="pstrut" style="height:4.8548em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3548em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:5.2096em;border-right-width:0.04em;border-right-style:solid;margin:0 -0.02em;vertical-align:-2.3548em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8548em;"><span style="top:-4.8548em;"><span class="pstrut" style="height:4.8548em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8548em;"><span style="top:-5.0148em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.8148em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-2.2052em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-1.0052em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3548em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8548em;"><span style="top:-5.0148em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">1b</span></span></span></span></span></span><span style="top:-3.8148em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">fresh</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4404em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2921em;"><span style="top:-3.2921em;"><span class="pstrut" style="height:3.5921em;"></span><span class="stretchy colorbox mtight" style="height:1.5921em;background-color:LightBlue;"></span></span><span style="top:-3.5921em;"><span class="pstrut" style="height:3.5921em;"></span><span class="mord mtight boxpad"><span class="mord mathnormal sizing reset-size3 size6" style="color:#28ae7b;">x</span><span class="mord sizing reset-size3 size6" style="color:#28ae7b;">.</span><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.01968em;color:#28ae7b;">l</span><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.02778em;color:#28ae7b;">r</span><span class="mord mathnormal sizing reset-size3 size6" style="color:#28ae7b;">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7696em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-2.2052em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-1.0052em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3548em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.3548em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-1.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎭</span></span></span><span style="top:-1.892em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎬</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.616em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.616em' style='width:0.8889em' viewBox='0 0 888.89 616' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V616 H384z M384 0 H504 V616 H384z'/></svg></span></span><span style="top:-4.9em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎫</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h5 id="definition-buried"><a class="header" href="#definition-buried">Definition: Buried</a></h5>
<p>A <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message can become irrelevant if, after a time, an entire quorum of acceptors has seen <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span>s with different values, <span style="background-color: #E2E2FF">the same learner</span>, and higher ballot numbers. We call such a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> <em>buried</em> (in the context of some later message <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;color:#9d38bd;">y</span></span></span></span>):
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1667em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Buried</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">2a</span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;color:#9d38bd;">y</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:7.3544em;vertical-align:-3.4272em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-1.366em;"><span class="pstrut" style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.358em;"><span class="pstrut" style="height:3.816em;"></span><span style="height:1.816em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.816em' style='width:0.8889em' viewBox='0 0 888.89 1816' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z'/></svg></span></span><span style="top:-3.816em;"><span class="pstrut" style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.958em;"><span class="pstrut" style="height:3.816em;"></span><span style="height:1.816em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.816em' style='width:0.8889em' viewBox='0 0 888.89 1816' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z'/></svg></span></span><span style="top:-6.766em;"><span class="pstrut" style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.9272em;"><span style="top:-5.9272em;"><span class="pstrut" style="height:5.9272em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.4272em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:7.3544em;border-right-width:0.04em;border-right-style:solid;margin:0 -0.02em;vertical-align:-3.4272em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.9272em;"><span style="top:-5.9272em;"><span class="pstrut" style="height:5.9272em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.9272em;"><span style="top:-6.0872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-4.8872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-3.6872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-2.4872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-1.2872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:0.0672em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.4272em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.9272em;"><span style="top:-6.0872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;color:#9d38bd;">y</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-4.8872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;color:#6495ed;">z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">2a</span></span></span></span></span></span><span style="top:-3.6872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">{</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;color:#6495ed;">z</span></span></span><span class="mclose delimcenter" style="top:0em;">}</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-2.4872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">V</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;color:#6495ed;">z</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">V</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-1.2872em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;color:#6495ed;">z</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:0.0672em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9944em;"><span style="top:-2.9944em;"><span class="pstrut" style="height:3.2944em;"></span><span class="stretchy colorbox" style="height:1.2944em;background-color:LightBlue;"></span></span><span style="top:-3.2944em;"><span class="pstrut" style="height:3.2944em;"></span><span class="mord boxpad"><span class="mord mathnormal" style="margin-right:0.04398em;color:#6495ed;">z</span><span class="mord" style="color:#6495ed;">.</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#6495ed;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#6495ed;">r</span><span class="mord mathnormal" style="color:#6495ed;">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mord" style="color:#28ae7b;">.</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#28ae7b;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#28ae7b;">r</span><span class="mord mathnormal" style="color:#28ae7b;">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.4272em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.4272em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-1.366em;"><span class="pstrut" style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎭</span></span></span><span style="top:-1.358em;"><span class="pstrut" style="height:3.816em;"></span><span style="height:1.816em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.816em' style='width:0.8889em' viewBox='0 0 888.89 1816' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z'/></svg></span></span><span style="top:-3.816em;"><span class="pstrut" style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎬</span></span></span><span style="top:-4.958em;"><span class="pstrut" style="height:3.816em;"></span><span style="height:1.816em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.816em' style='width:0.8889em' viewBox='0 0 888.89 1816' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1816 H384z M384 0 H504 V1816 H384z'/></svg></span></span><span style="top:-6.766em;"><span class="pstrut" style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎫</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.453em;vertical-align:-0.7696em;"></span><span class="mord" style="color:#28ae7b;"><span class="mord mathnormal" style="color:#28ae7b;">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4404em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#28ae7b;"><span class="mord mtight" style="color:#28ae7b;"><span class="mord mtight" style="color:#28ae7b;"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2921em;"><span style="top:-3.2921em;"><span class="pstrut" style="height:3.5921em;"></span><span class="stretchy colorbox mtight" style="color:#28ae7b;height:1.5921em;background-color:LightBlue;"></span></span><span style="top:-3.5921em;"><span class="pstrut" style="height:3.5921em;"></span><span class="mord mtight boxpad" style="color:#28ae7b;"><span class="mord mathnormal sizing reset-size3 size6" style="color:#28ae7b;">x</span><span class="mord sizing reset-size3 size6" style="color:#28ae7b;">.</span><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.01968em;color:#28ae7b;">l</span><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.02778em;color:#28ae7b;">r</span><span class="mord mathnormal sizing reset-size3 size6" style="color:#28ae7b;">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7696em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<h5 id="definition-connected-2a-messages"><a class="header" href="#definition-connected-2a-messages">Definition: Connected 2a Messages</a></h5>
<p>Entangled learners must agree, but learners that are not connected are not entangled, so they need not agree. Intuitively, a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message references a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message to demonstrate that some learner may have decided some value. For learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span>, it can be useful to find the set of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages from the same sender as a message <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span></span> (and sent earlier) which are still unburied and for learners connected to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span>. The <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> cannot be used to make any new <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages for learner <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span> that have values different from these <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4224em;vertical-align:-0.5058em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Con2as</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.7042em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9151em;"><span style="top:-2.9151em;"><span class="pstrut" style="height:3.2151em;"></span><span class="stretchy colorbox mtight" style="height:1.2151em;background-color:LightBlue;"></span></span><span style="top:-3.2151em;"><span class="pstrut" style="height:3.2151em;"></span><span class="mord mtight boxpad"><span class="mord mathnormal sizing reset-size3 size6" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5058em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:6.4em;vertical-align:-2.95em;"></span><span class="mord"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-1.366em;"><span class="pstrut" style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.358em;"><span class="pstrut" style="height:3.216em;"></span><span style="height:1.216em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.216em' style='width:0.8889em' viewBox='0 0 888.89 1216' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1216 H384z M384 0 H504 V1216 H384z'/></svg></span></span><span style="top:-3.216em;"><span class="pstrut" style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.358em;"><span class="pstrut" style="height:3.216em;"></span><span style="height:1.216em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.216em' style='width:0.8889em' viewBox='0 0 888.89 1216' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1216 H384z M384 0 H504 V1216 H384z'/></svg></span></span><span style="top:-5.566em;"><span class="pstrut" style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.45em;"><span style="top:-5.45em;"><span class="pstrut" style="height:5.45em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="vertical-separator" style="height:6.4em;border-right-width:0.04em;border-right-style:solid;margin:0 -0.02em;vertical-align:-2.95em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.45em;"><span style="top:-5.45em;"><span class="pstrut" style="height:5.45em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.45em;"><span style="top:-5.66em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"></span></span><span style="top:-4.46em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-3.26em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-2.06em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord">∧</span></span></span><span style="top:-0.65em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord">∧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.45em;"><span style="top:-5.66em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">2a</span></span></span></span></span></span><span style="top:-4.46em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-3.26em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-2.06em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord">¬</span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Buried</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span><span style="top:-0.65em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:LightBlue;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="mord" style="color:#6495ed;">.</span><span class="mord mathnormal" style="margin-right:0.01968em;color:#6495ed;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;color:#6495ed;">r</span><span class="mord mathnormal" style="color:#6495ed;">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Con</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:#df0030;">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-1.366em;"><span class="pstrut" style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎭</span></span></span><span style="top:-1.358em;"><span class="pstrut" style="height:3.216em;"></span><span style="height:1.216em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.216em' style='width:0.8889em' viewBox='0 0 888.89 1216' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1216 H384z M384 0 H504 V1216 H384z'/></svg></span></span><span style="top:-3.216em;"><span class="pstrut" style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎬</span></span></span><span style="top:-4.358em;"><span class="pstrut" style="height:3.216em;"></span><span style="height:1.216em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='1.216em' style='width:0.8889em' viewBox='0 0 888.89 1216' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V1216 H384z M384 0 H504 V1216 H384z'/></svg></span></span><span style="top:-5.566em;"><span class="pstrut" style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎫</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h5 id="definition-fresh"><a class="header" href="#definition-fresh">Definition: Fresh</a></h5>
<p>Acceptors send a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message whenever they receive a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span> message with a ballot number higher than they have yet seen. However, this does not mean that the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span>'s value (which is the same as the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord mathnormal">a</span></span></span></span>'s) agrees with that of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages the acceptor has already sent. We call a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> message <em>fresh</em> (with respect to a learner)  when its value agrees with that of unburied <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> messages the acceptor has sent.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4224em;vertical-align:-0.5058em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">fresh</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.7042em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9151em;"><span style="top:-2.9151em;"><span class="pstrut" style="height:3.2151em;"></span><span class="stretchy colorbox mtight" style="height:1.2151em;background-color:LightBlue;"></span></span><span style="top:-3.2151em;"><span class="pstrut" style="height:3.2151em;"></span><span class="mord mtight boxpad"><span class="mord mathnormal sizing reset-size3 size6" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5058em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">1b</span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord">∀</span><span class="mord mathnormal" style="color:#6495ed;">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2558em;vertical-align:-0.5058em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Con2as</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.7042em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9151em;"><span style="top:-2.9151em;"><span class="pstrut" style="height:3.2151em;"></span><span class="stretchy colorbox mtight" style="height:1.2151em;background-color:LightBlue;"></span></span><span style="top:-3.2151em;"><span class="pstrut" style="height:3.2151em;"></span><span class="mord mtight boxpad"><span class="mord mathnormal sizing reset-size3 size6" style="color:#df0030;">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5058em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mord">.</span><span class="mspace"> </span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">V</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">V</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">m</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span></span></p>
<h5 id="definition-well-formed"><a class="header" href="#definition-well-formed">Definition: Well-Formed</a></h5>
<p>We define what it means for a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> or a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> message to be <em>well-formed</em>.
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.963em;vertical-align:-1.2315em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7315em;"><span style="top:-3.8148em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">llF</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">1b</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;color:#6495ed;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Tran</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="color:#28ae7b;">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;color:#6495ed;">y</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;color:#6495ed;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Get1a</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⇒</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;color:#6495ed;">y</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">b</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#28ae7b;">x</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span><span style="top:-2.5381em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">llF</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;color:#df0030;">z</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord textit">2a</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">≜</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">q</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;color:#df0030;">z</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord" style="color:#df0030;"><span class="mord mathnormal" style="color:#df0030;">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4404em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight" style="color:#df0030;"><span class="mord mtight" style="color:#df0030;"><span class="mord mtight" style="color:#df0030;"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2921em;"><span style="top:-3.2921em;"><span class="pstrut" style="height:3.5921em;"></span><span class="stretchy colorbox mtight" style="color:#df0030;height:1.5921em;background-color:LightBlue;"></span></span><span style="top:-3.5921em;"><span class="pstrut" style="height:3.5921em;"></span><span class="mord mtight boxpad" style="color:#df0030;"><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.04398em;color:#df0030;">z</span><span class="mord sizing reset-size3 size6" style="color:#df0030;">.</span><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.01968em;color:#df0030;">l</span><span class="mord mathnormal sizing reset-size3 size6" style="margin-right:0.02778em;color:#df0030;">r</span><span class="mord mathnormal sizing reset-size3 size6" style="color:#df0030;">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7696em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∧</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;color:#df0030;">z</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">Sig</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord"><span class="mord text"><span class="mord textrm">q</span></span><span class="mord"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;color:#df0030;">z</span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2315em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p>
<p>An acceptor who has received a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord mathnormal">b</span></span></span></span> sends a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span> for every learner for which it can produce a Well-formed <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span>.</p>
<h3 id="incentive-model"><a class="header" href="#incentive-model">Incentive Model</a></h3>
<p>Goal:</p>
<ul>
<li>Incentivizing token holders to put down their stake for security</li>
<li>Disincentivizing byzantine behavior</li>
</ul>
<p>Rewards: </p>
<ul>
<li>Participating in consensus based on backing stake: this includes validating and voting</li>
<li>Producing blocks</li>
</ul>
<p>Slashing: there are a number of offenses</p>
<ul>
<li>Invalid blocks</li>
<li>Equivocation (caught)</li>
</ul>
<h3 id="fees"><a class="header" href="#fees">Fees</a></h3>
<blockquote>
<p>The first question is once there is no demand for atomic batches of transactions, do we keep the chimera chain alive? </p>
</blockquote>
<p>We need to figure out whether killing the chimera chain (and potentially requiring a new genesis later) is not too expensive.</p>
<blockquote>
<p>The second question is whether we update the quroum changes whenever they happen or when we have a transaction? </p>
</blockquote>
<p>The first option is expensive and can lead to attack if not handled well. We need to figure out whether the latter option is safe. </p>
<ul>
<li>If the answer is yes for first question and we pick the first option for the second question: </li>
</ul>
<p>Since all chimera chains need to be updated when the quorums on the base chains change, we need to figure out who pays for these updates. For example, a chimera chain might have had a block produced last week, but since the has been updated 200 times that is 200 blocks that do not have any transactions with transaction fees. If this is not paid by anyone, it becomes a burden for acceptors and an attack vector for the adversary. </p>
<p>We may need to add a &quot;locked&quot; fee for making new chimera chains. In particular, we don't want an attacker to make a lot of chains, forcing base chains to update all of them with each quorum change. </p>
<p>Alternatively, each &quot;chimera chain&quot; could keep an account on each base chain that is funded by a portion of transaction fees, from which a small fee is extracted with each validator update. When the account runs dry, the (parent)base chains are allowed to kill the chimera chain (even if there are still objects on there). We could allow anyone to contribute to these accounts. We could even prohibit anyone who did not contribute from sending IBC messages between chimera and parent chains. </p>
<h2 id="security-discussion"><a class="header" href="#security-discussion">Security Discussion</a></h2>
<p>Note that the chimera cannot guarantee atomicty under the same adversary assumption as the base chains. For example, if we assume the adversar to control less than 1/3 of the stake to assure safety on the base chains, atomicity is not guaranteed for such an adversary but inly a weaker one. This is important for users so they can decide whether for their transaction chimera chians would be secure enough. </p>
<p>By setting the quorums of each learner to be the same as the quorums of the corresponding base chain, we ensure that each learner's view is <em>as consistent</em> as the base chain. Specifically, two instantiations of the learner for some base chain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> should decide on the same blocks in any chimera chain, unless the adversary is powerful enough to fork chain <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>.</p>
<p>&quot;Accurate&quot; (or &quot;self-engangled&quot;) learners (defined above) correspond to base chains where the adversary is in fact powerful enough to fork the chain. Proving that a learner is accurate is equivalent to proving that its base chain cannot fork. </p>
<p>Two learners <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="color:#df0030;">a</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span> corresponding to different base chains will decide on the same blocks (which is what makes atomic batches useful), so long as one of the safe sets in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#df0030;">a</span></span></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="color:#6495ed;">b</span></span></span></span></span></span></span> is composed entirely of safe acceptors. The stake backing these safe sets represents the &quot;assurance&quot; that atomic batches remain atomic, as well as the maximum slashing punishment should they lose atomicity. </p>
<p>Loss of atomicity is a bit like a &quot;trusted bridge&quot; that turns out not to be trustworthy: each state machine within the chimera chain has as much integrity as its base chain, but atomicity properties of multi-state-machine atomic batches have a lesser, but still well-defined, guarantee. Loss of atomicty allows double spending on the chimera chain. And while misbehavior has happened in such an attack it is not trivial to slash the misbehaving acceptor since according to each chain everything has been carried out correctly. </p>
<h2 id="open-challenges"><a class="header" href="#open-challenges">Open Challenges</a></h2>
<h3 id="programming-model"><a class="header" href="#programming-model">Programming Model</a></h3>
<h4 id="atomic-batches"><a class="header" href="#atomic-batches">Atomic Batches</a></h4>
<p>We'll need a way to specify that a batch of transactions should be committed together or not at all. Ideally, this should communicate to the programmer how reliably this atomicity is (see &quot;practical considerations&quot; below). On an chimera chain, batches can include transactions from any of their &quot;main chains&quot;. If we want to have match-making, transactions will need to be able to say something like &quot;if I'm in an atomic batch that matches these criteria, then do this...&quot;.</p>
<p>Each atomic batch should be scheduled within one block.</p>
<p>(We encode transactions with Portobuff and Borsht.) We need define structures such that transactions can be bundled and cannot be carried out separately.</p>
<h4 id="atomic-communication"><a class="header" href="#atomic-communication">Atomic Communication</a></h4>
<p>Transactions within an atomic batch need to be able to send information to each other (and back). For example, in a market with a fluctuating exchange rate, a market transaction could send a message to an account, which transfers money, and sends a message to another account, which transfers goods. We need a language in which this communication takes place with minimal constraints on the state machines involved, so we should probably adapt the IBC communication language. </p>
<p>We need to figure out inter-chain communication works for transactions communicating with each other within an atomic batch.</p>
<h4 id="can-we-have-synchronous-in-terms-of-blocks-ibc"><a class="header" href="#can-we-have-synchronous-in-terms-of-blocks-ibc">Can we have synchronous (in terms of blocks) IBC?</a></h4>
<p>Yes: when the quorums involved in two chains are the same, then we can guarantee that (unless there are sufficient failures to fork the chain) an IBC message sent in one chain will arrive at the other chain (in a transaction) within a specific number (perhaps as few as 1?) of blocks. This is because some of the machines in the quorum that approved the &quot;send&quot; transaction must be in the quorum that decides the next block, so they can refuse to decide on blocks that lack the &quot;receive&quot; transaction.</p>
<p>Note that we may need to rate-limit sends to ensure that all sends can be received in time (availability).</p>
<p>Note also that blinding transactions makes this hard.</p>
<h3 id="match-making"><a class="header" href="#match-making">Match Making</a></h3>
<p>We can in priciple do cross-chain match-making. If we want an on-chain market, an chimera chain might be a good place to do it. However, full nodes in the gossip layer might be able to gather sets of transactions that match the transactions' &quot;If I'm in an atomic batch ...&quot; criteria, bundle them into atomic batches, and then send those off to be committed.</p>
<p>We may want to incorporate some incentive scheme for good match-making. Matchmakers include nodes who are full nodes on both chains, and in principle could include any node who sees the request transactions. </p>
<h3 id="changing-quorums"><a class="header" href="#changing-quorums">Changing Quorums?</a></h3>
<!--Assume we have one "main chain" that decides who the quorums used by some other (possibly heterogeneous) chains are. Hopefully, quorum changes are infrequent. -->
<h4 id="2-phase-commit"><a class="header" href="#2-phase-commit">2 Phase Commit</a></h4>
<p>We could require that any quorum-chainging transaction has to be 2-phase committed. Essentially, the &quot;main chain&quot; announces that it won't progress beyond a certain block until everyone has appended a new block that sets the (same) new quorums, and sends a response by IBC. It can then progress only with IBC responses from all the other chains that use these quorums.</p>
<!--This solution is potentially slow: arbitrarily many chains may have to be involved. That said, at least in principle, they all have the same safety and liveness properties.-->
<h4 id="synchronous-ibc"><a class="header" href="#synchronous-ibc">Synchronous IBC</a></h4>
<p>We may be able to leverage our &quot;synchronous&quot; IBC idea above for faster quorum changes. The difficulty is that it allows a finite number of blocks to be appended to the chimera chains before they receive the quorum change method. These chains can be arbitrarily slow, so that could take arbitrarily long.</p>
<p>Need to figure out inter-machine communication for acceptors, since they might run many machines.</p>
<hr />
<h2 id="discussion-questions-practical-considerations"><a class="header" href="#discussion-questions-practical-considerations">Discussion Questions /Practical Considerations</a></h2>
<ul>
<li>Optimizing messgaing: Pipelining (from Hotstuff), Kauri, BFTree</li>
<li>Replicating state machines</li>
<li>Probems Tendermint has: 
<ul>
<li>Doesnt allow many validators</li>
<li>Lightclient design</li>
</ul>
</li>
<li>Optimizing recoveryfrom slow finalization: Separating block prosuction from finalizing, finalzing more than one block</li>
<li>ABCI ++? Another version of it</li>
<li>Look into other papers of Dalia Malkhi / Fast HotStuff?</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="private-bartering-circuits"><a class="header" href="#private-bartering-circuits">Private bartering circuits</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="private-execution-architecture"><a class="header" href="#private-execution-architecture">Private execution architecture</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="decentralised-proof-of-identity"><a class="header" href="#decentralised-proof-of-identity">Decentralised proof-of-identity</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="public-goods-funding"><a class="header" href="#public-goods-funding">Public goods funding</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="fee-system-1"><a class="header" href="#fee-system-1">Fee system</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="j1"><a class="header" href="#j1">J1</a></h1>
<h2 id="juvix"><a class="header" href="#juvix">Juvix</a></h2>
<p>For now, see <a href="https://github.com/anoma/juvix">Juvix</a>.</p>
<h2 id="vampir"><a class="header" href="#vampir">Vampir</a></h2>
<p>See <a href="architecture/./j1/vampir/vampir.html">Vampir</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h2 id="vampir-1"><a class="header" href="#vampir-1">Vampir</a></h2>
<ul>
<li><a href="architecture/j1/vampir/./ir_design.html">Vampir Design Philosophy</a></li>
<li><a href="architecture/j1/vampir/./ir_spec.html">Vampir Spec (working draft)</a></li>
<li><a href="architecture/j1/vampir/./compilation_diagrams.html">Diagrams</a></li>
<li><a href="architecture/j1/vampir/./juvix-to-vampir.html">Juvix -&gt; Vampir Details</a></li>
<li>Examples
<ul>
<li><a href="architecture/j1/vampir/./examples.html">TestCircuit example</a></li>
<li><a href="architecture/j1/vampir/./juvix-to-vampir.html">Coprime Token example in Juvix-&gt;Vampir Details</a></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ir-design"><a class="header" href="#ir-design">IR Design</a></h1>
<h2 id="generality"><a class="header" href="#generality">Generality</a></h2>
<p>A circuit IR ought to capture the intention of the circuit only. It should be agnostic to the proving system features and also be agnostic to the specific constraint system it targets (so circuits written in the IR can compile to R1CS, vanilla Plonk, Plonk with lookups, Plonk with custom gates, or any other constraint system). This way a circuit can be written canonically in the IR and different backends with different features can interpret and execute the IR as they wish.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>An IR that can express every arithmetic circuit <em>and</em> indicate custom gates or lookup gates <em>and</em> be interpretable in R1CS or Plonkish constraints only needs two basic objects:</p>
<ul>
<li>multivariate polynomial constraints</li>
<li>aliases for sets of multivariate polynomial constraints (subcircuits)</li>
</ul>
<p>Additional auxiliary objects will need to be provided alongside (but separate to) the circuit:</p>
<ul>
<li>input maps to assist in witness/public input generation</li>
</ul>
<h2 id="arithmetic-gates-are-unbounded-multivariate-polynomial-constraints"><a class="header" href="#arithmetic-gates-are-unbounded-multivariate-polynomial-constraints">Arithmetic Gates Are Unbounded Multivariate Polynomial Constraints</a></h2>
<p>An arithmetic circuit is just a representation of a system of multivariable polynomial constraints. This system must be broken down into smaller low-degree constraints that &quot;fit&quot; into the constraint format of the target proving system.</p>
<p>If the IR is meant to capture a circuit only, agnostic of the target constraint system, then the IR should not be limited by R1CS or Plonkish formats. The IR should not force the circuit programmer to make arbitrary choices in how to break down the circuit to &quot;fit&quot; the circuit into the IR, either. It would be best to let the proving system backend choose how to break down the circuit in a way that is optimal for it's specific features.</p>
<p>For this reason, <em>unbounded</em> multivariable constraints should be used to represent all arithmetic gates.</p>
<h3 id="optimizing-arithmetic-circuits"><a class="header" href="#optimizing-arithmetic-circuits">Optimizing Arithmetic Circuits</a></h3>
<p>It is possible that if a polynomial constraint system is expressed appropriately then known algorithms for manipulating polynomials like Gröbner basis techniques <em>may</em> be able to do some optimization of arithmetic circuits automatically, but the degree of optimization is unknown.</p>
<p>There is also <a href="https://eprint.iacr.org/2020/1586.pdf">CirC</a>, an infrastructure for building compilers for <em>existentially quantified circuits</em> which include arithmetic circuits. CirC is designed to be a shared infrastructure that assists in the creation of front-end compilers by leveraging existing research on constraint languages. The CirC system produces its own IR which provides some optimization for arithmetic circuits and can assist in bug-finding.</p>
<h3 id="how-aztec-does-polynomial-constraints"><a class="header" href="#how-aztec-does-polynomial-constraints">How Aztec Does Polynomial Constraints</a></h3>
<p>Aztec has a DSL Noir, which compiles to their IR called ACIR, which was an inspiration for this IR design. ACIR uses <em>bounded</em> multivariable constraints which are limited to degree 2. This allows them to target R1CS and vanilla Plonkish constraints easily, but forces the circuit programmer to make choices which may not be optimal in order to fit larger degree constraints into the IR.</p>
<p>Limiting the constraints to degree 2 obfuscates subcircuits that are degree 3 and up by forcing them to be split into pieces. This can make it more difficult for the backend proving system to recognize patterns in the circuit which could be used to optimize proving, especially if the subcircuits are broken down inconsistently.</p>
<p>Furthermore, it is quite feasible to add custom gates in Plonk which are higher than degree 2, but ACIR's degree limit makes this more difficult for the backend to do.</p>
<p>Despite this flaw, ACIR is a pretty good IR that could serve our purposes. Unfortunately there isn't a detailed spec for ACIR that I've been able to find. There is a <a href="https://noir-lang.github.io/book/index.html">Noir book</a> which has a nice <a href="https://noir-lang.github.io/book/c_overview.html">diagram for compilation to ACIR</a> but details of the exact format ACIR takes is not specified.</p>
<h2 id="aliased-subcircuits"><a class="header" href="#aliased-subcircuits">Aliased Subcircuits</a></h2>
<p>It is convenient to have aliases for subcircuits that are used frequently. Aliases for common subcircuits (like <code>range</code>, <code>pedersen</code>, <code>xor</code>, or <code>sha3</code>) can be included in a standard library. The IR should also allow the circuit writer to define their own subcircuits and give them aliases. Then a DSL can shift the majority (or entirety?) of the low-level circuit programming to the IR for a clean separation of concerns.</p>
<p>Aliased subcircuits are likely to be used repeatedly. Therefore they also serve as a signal to the proving system backend that an optimization ought to be applied to that subcircuit if it is possible.</p>
<h2 id="aliases-can-be-custom-gates"><a class="header" href="#aliases-can-be-custom-gates">Aliases Can Be Custom Gates</a></h2>
<p>A compiler for a particular backend should be able to decide to replace gates or sets of gates in a circuit with a custom gate if it has one available to add into its proving system.</p>
<p>Custom gates in Plonk are single gates that <em>replace</em> a subcircuit. The polynomial constraints defining the subcircuit are moved out of the circuit and become integrated into the proving system.</p>
<p>The polynomial constraints that <em>check</em> the custom gate in the proving system are precisely the same polynomials that make up the subcircuit the custom gate replaces! This allows <em>aliases</em> to double as indicators for custom gates the backend may decide to incorporate.</p>
<p>For example, suppose while writing my circuit I notice that there are many repeated subcircuits with the same form, like this constraint that checks if <code>a,b,c</code> is a Pythagorean triple:</p>
<pre><code>0 = a^2 + b^2 - c^2
</code></pre>
<p>I can alias this gate for convenience <em>and</em> to indicate that it should become a custom gate if possible in the backend proving system.</p>
<pre><code>// alias
def pyth a b c {a^2 + b^2 - c^2}
</code></pre>
<p>If the proving system lacks custom gate support then it will interpret the alias as just an alias and simply replace the aliased gates with the subcircuits they name as usual. If it has a modular proving system with custom gate support it will incorporate a polynomial <code>a(X)^2 + b(X)^2 - c(X)^2</code> into its proving system instead, making <code>pyth</code> a true custom gate defined in the IR circuit itself.</p>
<h2 id="standard-lookup-gates-and-tables"><a class="header" href="#standard-lookup-gates-and-tables">Standard Lookup Gates and Tables</a></h2>
<p>Similarly to custom gates, if a user specifies particular gates which are available as lookups, a backend compiler may decide to replace those gates with lookup gates and construct a lookup table automatically. Since most lookup use cases are for common operations like <code>xor</code> or <code>mod</code> the user won't have to define a lookup table in the circuit or use a <code>lookup</code> gate directly. This is in-line with the idea that the IR should express a circuit, not demand how it is to be executed. For this reason, lookup gates do not need to be expressed in the IR.</p>
<p>To use standard lookups, the circuit programmer writes their circuit in the IR using a standard library of aliases for common subcircuits like <code>xor</code> and <code>mod</code>. If lookups are enabled in the proof system then tables for <code>xor</code> and <code>mod</code> will be created automatically (or retrieved from a library of precomputed tables) and the indicated aliased subcircuits are replaced with the correct lookup gates.</p>
<h2 id="input-maps"><a class="header" href="#input-maps">Input Maps</a></h2>
<p>Arithmetic circuits have &quot;input wires&quot; which accept the &quot;initial inputs&quot; to circuit. However, many intermediate wires need to be computed from these initial inputs during the proving process. This is because the ciruit must be broken down into smaller constraints to fit into the proving system, and the process of breaking circuits apart introduces new variables whose values need to be computed.</p>
<p>When the backend compiles the IR into a circuit, it needs to know all initial inputs to the circuit. The &quot;intermediate&quot; or &quot;internal&quot; values can be computed by the backend. For instance, in the Pythagorean example above, the Prover would need to supply <code>a,b,c</code> and the backend can compute the intermediate values <code>a^2,b^2,c^2</code> from these if it needs to. Since the circuit language of the IR does not include values at all, we need another way to get the values of <code>a,b,c</code> to the backend.</p>
<p>We can use an &quot;input map&quot; for this. This is a simple auxilary file that lists the input variables and their values. A JSON dictionary object or similar key-value pair system would work well:</p>
<pre><code>{
    &quot;a&quot;: 5,
    &quot;b&quot;: 12,
    &quot;c&quot;: 13,
}
</code></pre>
<p>Input maps need to be provided for the initial input values of the Prover's witnesses as well as the public input values. The backend compiler will take the initial input values and the intermediate values it computes and assemble them into vectors of field elements required by the proving and verification algorithms.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ir-spec-working-draft"><a class="header" href="#ir-spec-working-draft">IR Spec Working Draft</a></h1>
<p>There are two possible approaches to naming: (1) constraint systems,
constraints, and variables, or (2) circuits, gates, and wires. Since <code>plonk</code> is
a proof system for zero-knowledge <em>circuits</em>, we stick with circuit-based
terminology.</p>
<h2 id="wires"><a class="header" href="#wires">Wires</a></h2>
<ul>
<li>A wire is a fundamental, atomic, immutable representation of data.</li>
<li>Name: names of wires are strings that start with a letter, and can include underscores and digit characters.</li>
<li>They are allocated at compile time as they appear.</li>
<li>All wires are assigned values in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> (either at compile-time or at prover / verifier run-time), where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> is a globally fixed (usually ~256-bit) prime. TODO: should we add <code>#pragma</code> declarations for specifying <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>?</li>
</ul>
<h3 id="public-wires"><a class="header" href="#public-wires">Public wires</a></h3>
<p>Public wires are public inputs into the circuit that are not known at compile-time. To allocate the variable <code>contract_public_key</code> as public we simply declare it in the following statement:</p>
<pre><code>pub contract_public_key
</code></pre>
<p>The variable <code>contract_public_key</code> can then be used in a polynomial constraint like any other variable. Alternatively, one can declare a wire to be public by adding the keyword <code>pub</code> when referring to the wire.</p>
<h3 id="private-wires"><a class="header" href="#private-wires">Private wires</a></h3>
<p>Private wires are the Prover's secret witnesses. Any variable not explicitly made public is a private wire.</p>
<h3 id="named-vs-unnamed-wires"><a class="header" href="#named-vs-unnamed-wires">Named vs. unnamed wires</a></h3>
<p>Some wires are implicitly created and can be unnamed from the perspective of the IR.</p>
<h2 id="constants-aka-scalars"><a class="header" href="#constants-aka-scalars">Constants (a.k.a scalars)</a></h2>
<p>Fixed constants are strings of digits that are interpreted as decimal integers. They can be preceded by a &quot;-&quot; to indicate that they are negative.</p>
<h2 id="expressions"><a class="header" href="#expressions">Expressions</a></h2>
<p>An expression is any code block that returns one or more values encoded in unnamed wires.</p>
<h3 id="polynomial-expressions"><a class="header" href="#polynomial-expressions">Polynomial Expressions</a></h3>
<p>Polynomial expressions are algebraic expressions involving of wires and
constants (&quot;multi-variable&quot; polynomial where wires are &quot;variables&quot;). Below are
two polynomial expressions.</p>
<pre><code>x^2 - 1
x^2 + y^2 - z^2
</code></pre>
<p>The polynomial ought to be expressed in a standard format that can easily be plugged into polynomial solvers and other tools.</p>
<h3 id="gate-expressions"><a class="header" href="#gate-expressions">Gate expressions</a></h3>
<p>Some gates provide output wires. It forms an expression when they are called without output wires in the arguments. For example, <code>add x 1</code>, <code>mul x y</code>.</p>
<h2 id="constraint-statements"><a class="header" href="#constraint-statements">Constraint statements</a></h2>
<p>A constraint statement constrains a set of wires. Named and unnamed internal
wires can be created as a consequence of a constraint statement. There are two
types of constraint statements, equality statements and gate statements.</p>
<h3 id="equality-statement"><a class="header" href="#equality-statement">Equality statement</a></h3>
<p>An equality statement constrains two expressions (left- and right-hand side) to be equal to each other.</p>
<p>Here is an equality statement for checking if three inputs form a Pythagorean triple:</p>
<pre><code>0 = x^2 + y^2 - z^2
</code></pre>
<p>This gate represents a constraint. That is, this gate constrains the polynomial indicated to equal zero. The variables used in the polynomial that have not already been used earlier will be allocated when the polynomial is processed.</p>
<p>It is convenient sometimes to think of a polynomial expression as an &quot;assignment&quot;. We can achieve this by allowing polynomial constraints to be written as an equation with a left and right side. These two polynomials are equivalent:</p>
<pre><code>x_1^3 - 5x_2^2 - x_3
x_3 = x_1^3 - 5x_2^2
</code></pre>
<p>Since this is not <em>true</em> assignment, but merely a constraint, it is also valid to &quot;assign&quot; to scalars. These are equivalent:</p>
<pre><code>0 = x_1 * x_2 - 42
42 = x_1 * x_2
</code></pre>
<p>Equality statements involving general expressions are compiled down to gate statements by the backend.</p>
<h3 id="gate-statement"><a class="header" href="#gate-statement">Gate statement</a></h3>
<p>A gate constraint is formed when a gate is called with all input and output wires.</p>
<pre><code>bool x
bool x * y
</code></pre>
<h2 id="alias-statement"><a class="header" href="#alias-statement">Alias statement</a></h2>
<p>An alias can be given to sets of constraint statements that are used often. Curly braces are used to indicate a set of constraints.</p>
<pre><code>// definition of my_alias
def my_alias input_wires... -&gt; output_wires... {
	constraint_statement_1
	constraint_statement_2

	.
	.
}

// calling my_alias can be done like this:
my_alias input_1 input_2 ... output_1 output_2 ...

// or like this:
output_1 output_2 ... = my_alias input_1 input_2 ...
// this is technically an equality statement where the rhs is a gate expression
</code></pre>
<p>In arithmetic constraints there really is no distinction between inputs and outputs. We make the distinction here to tell the backend compiler how to interpret a constraint written in &quot;assignment&quot; mode and how to compose constraints.</p>
<p>Since aliased subcircuits are likely to be used more than once, a backend compiler may decide to replace an aliased subcircuit with a lookup gate or custom gate if it has those features available.</p>
<p>Often times, the gates supported by the backend are not agnostic to the wire types. To build alias gates for these built-in gates, one needs to declare the required wire types in the alias definition. For example:</p>
<pre><code>def eq (priv x) -&gt; (priv y) {
  y = poly_gate[0 1 0 -1 0] x x
}

def eq (priv x) -&gt; (pub y) {
  y = pubout_poly_gate[0 1 0 0 0] x x x
}

def eq (priv x) -&gt; (const y) {
  poly_gate[0 1 0 0 y] x x x
}
</code></pre>
<p><a href="architecture/j1/vampir/./tests/arithmetic_aliases.pir">More examples</a>.</p>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<h4 id="no-output-gate"><a class="header" href="#no-output-gate">No-output Gate</a></h4>
<p>A range gate is a commonly used gate that does not have a canonical output. A 2-bit range gate would be defined and called like this:</p>
<pre><code>// definition
def range_2 x {
	b_0 = b_0^2
	b_1 = b_1^2
	x = 2b_1 + b_0
}

// call
range_2 x
</code></pre>
<p>The variable <code>x</code> is now constrained to be 0, 1, 2, or 3.</p>
<p>Because the gate is defined with no outputs, trying to call it like this should produce an error:</p>
<pre><code>// invalid
y = range_2 x

// also invalid
x = range_2
</code></pre>
<h4 id="single-output-gate"><a class="header" href="#single-output-gate">Single-output Gate</a></h4>
<pre><code>// definition
add x y -&gt; z = { poly x + y - z}

// call
add x y z

// or
z = add x y
</code></pre>
<h4 id="multiple-outputs"><a class="header" href="#multiple-outputs">Multiple Outputs</a></h4>
<p>Aliased gates can give multiple outputs. Suppose we want to do integer division between two variables and want both the quotient and remainder as outputs (like <code>divmod</code> in Python).</p>
<pre><code>def divmod x y -&gt; q r { .... }

// then divmod can be called like this
divmod x y q r

// or this
q r = divmod x y
</code></pre>
<h4 id="composing-gates"><a class="header" href="#composing-gates">Composing Gates</a></h4>
<p>Gates can be composed using assignment mode or prefix mode.</p>
<pre><code>// definition
def curve_add x1 y1 x2 y2 -&gt; x3 y3 { ... }

// assignment mode definition
def curve_add_four x1 y1 x2 y2 x3 y3 x4 y4 -&gt; x5 y5 {
	mx1 my1 = curve_add x1 y1 x2 y2
	mx2 my2 = curve_add x3 y3 x4 y4
	x5 y5 = curve_add mx1 my1 mx2 my2
}

// prefix mode definition
def curve_add_four x1 y1 x2 y2 x3 y3 x4 y4 -&gt; x5 y5 {
	curve_add (curve_add x1 y1 x2 y2) (curve_add x3 y3 x4 y4)
}
</code></pre>
<h2 id="a-partial-list-of-built-in-gates-and-some-of-their-definitions-in-terms-of-polynomial-gates"><a class="header" href="#a-partial-list-of-built-in-gates-and-some-of-their-definitions-in-terms-of-polynomial-gates">A Partial List of Built-in Gates and (some of) their Definitions in Terms of Polynomial Gates</a></h2>
<pre><code>// x + y = z
def add x y -&gt; z { poly x + y - z }

// x - y = z
def sub x y -&gt; z { poly x - y - z }

// x*y = z
def mul x y -&gt; z { poly x * y - z }

// inv x = x_inv
def inv x -&gt; x_inv
// if x is 0, then x_inv is set to 0

// x &lt; y
def less x y { ... }

// x = r mod q
def mod x q -&gt; r { ... }

// bit decomp of x
def bits x -&gt; b_0 ... b_k { ... }

// bit pack of b_0 ... b_k
def bitpack b_0 ... b_k -&gt; x { bits x b_0 ... b_k }

// k = bit count of x
def bitcount x -&gt; k { ... }

// x a bool
def bool x {range_1 x}

// x &lt; 2^k 		k is an usize
def bit_range[k] x { ... }

// conditional / controlled selects
// out = opt_bit
def cselect bit opt_0 opt_1 -&gt; out
// bit = 1 =&gt; out = val / bit = 0 =&gt; out = 1
def cselect_1 bit val -&gt; out
// bit = 1 =&gt; out = 1 / bit = 0 =&gt; out = val
def cselect_0 bit val -&gt; out

// k-bit xor and
def xor[k] x y -&gt; z { ... }
def and[k] x y -&gt; z { ... }

// Twister Edwards curve addition
def variable_base_add x1 y1 x2 y3 -&gt; x3 y3
def fixed_base_add ...

// scalar mul potentially defined as internal alias using point addition and
bit decomposition
def variable_base_mul scalar x1 y1 -&gt; x2 y2
def fixed_base_mul scalar -&gt; x2 y2

// Blake2s(x) = y
def blake2s x .. -&gt; y { ... }

// Blake2b(x) = y
def blake2b x .. -&gt; y { ... }

// SHA-256(x) = y
def sha256 x .. -&gt; y { ... }

etc.
</code></pre>
<h3 id="built-in-gates-and-output-wires"><a class="header" href="#built-in-gates-and-output-wires">Built-in gates and output wires</a></h3>
<p>For built-in gates, we insist the backend to know how output wires are computed
given all the input wires. As a result, when generating a proof, output wires
of built-in gates need not be specified.</p>
<h2 id="prover-and-verifier-run-time-input-specification"><a class="header" href="#prover-and-verifier-run-time-input-specification">Prover and verifier run-time input specification</a></h2>
<p>To generate a proof, we need to provide a file specifying a circuit (or compiled
output from it), as well as (1) a table <code>PI</code> mapping all public wires
to their values (in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>) and (2) a table <code>W</code> mapping all non-output wires to
their values (again in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>).</p>
<p>To verify a proof, we need to provide, besides the proof, a file specifying a
circuit (or compiled output from it), as well as a table <code>PI</code> (same as in proof
generation).</p>
<p>Tables <code>PI</code> and <code>W</code> are given as a JSON formatted table.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="juvix---vampir"><a class="header" href="#juvix---vampir">Juvix -&gt; Vampir</a></h1>
<ul>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#juvix---vampir">Juvix -&gt; Vampir</a>
<ul>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#juvix---vampir-diagram">Juvix -&gt; Vampir Diagram</a></li>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#two-parties">Two Parties</a>
<ul>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#circuit-writer">Circuit Writer</a></li>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#prover">Prover</a></li>
</ul>
</li>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#example">Example</a>
<ul>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#writing-a-circuit-in-vampir">Writing a Circuit in Vampir</a></li>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#complete-circuit-written-in-vampir">Complete Circuit Written in Vampir</a></li>
<li><a href="architecture/j1/vampir/juvix-to-vampir.html#example-prover-runtime">Example Prover Runtime</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="juvix---vampir-diagram"><a class="header" href="#juvix---vampir-diagram">Juvix -&gt; Vampir Diagram</a></h2>
<p><img src="architecture/j1/vampir/./diagrams/juvix_vampir.svg" alt="" /></p>
<h2 id="two-parties"><a class="header" href="#two-parties">Two Parties</a></h2>
<p>There are two parties who may want to use a Juvix -&gt; Vampir compiler: a <a href="architecture/j1/vampir/juvix-to-vampir.html#circuit-writer">circuit writer</a> and a <a href="architecture/j1/vampir/juvix-to-vampir.html#prover">prover</a>.</p>
<h3 id="circuit-writer"><a class="header" href="#circuit-writer">Circuit Writer</a></h3>
<p>The circuit writer takes a function \(f\) and some backend parameters and writes a circuit in Vampir such that the circuit is satisfied by \((x,y)\) if \(f(x) = y\).</p>
<p>The inputs <em>and</em> outputs of the function \(f\) together become the <em>inputs</em> to the circuit. We will call these the &quot;initial inputs&quot; to the circuit.</p>
<h3 id="prover"><a class="header" href="#prover">Prover</a></h3>
<p>A Prover will want to check that their inputs to a circuit will actually satisfy it before going through the effort of constructing a proof.</p>
<p>Also a circuit typically needs to know the values of many auxililary variables that aren't specified as an input or output of the function. We will call these &quot;auxiliary inputs&quot;.</p>
<p>During a process we are calling &quot;<a href="architecture/j1/vampir/juvix-to-vampir.html#prover-runtime">prover runtime</a>&quot; the Prover computes the values of these auxiliary inputs which are specified in the Vampir circuit. If auxiliary inputs can't be found that satisfy the circuit then prover runtime should fail and notify the Prover.</p>
<p>The Prover Runtime takes a circuit written in Vampir, the backend parameters, and the Prover's initial inputs, and receives a witness map containing all of the inputs they need to satisfy the circuit, or \(\perp\) indicating their initial inputs are invalid.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Suppose I am writing some smart contracts that mint tokens as rewards for solving certain math problems. This particular contract rewards users with a freshly-minted token for submitting a correct proof that a pair of numbers is relatively prime. I want users to be able to include up to four numbers in the circuit (so that six total pairs need to be checked). In order to keep track of minted tokens publicly a user must also submit a count of the number of coprime pairs among the six, which serves as a public claim to their new tokens.</p>
<h3 id="writing-a-circuit-in-vampir"><a class="header" href="#writing-a-circuit-in-vampir">Writing a Circuit in Vampir</a></h3>
<p>Here we write this circuit in Vampir by hand. This can serve as a guide for the process that Juvix will need to perform.</p>
<p>A circuit can check if a pair of numbers is coprime by using Bezout's Identity, which states that integers \(a\) and \(b\) are coprime if there exist integers \(x\) and \(y\) such that \(ax+by = 1.\) This can be checked by the constraint \(0=ax+by-1\). Since we will use this constraint frequently we will define an alias for it:</p>
<pre><code>def coprime a b {
    0 = a*x + b*y - 1
}
</code></pre>
<p>We will combine this with some standard aliases provided by default in Vampir in order to finish writing the circuit.</p>
<h3 id="complete-circuit-written-in-vampir"><a class="header" href="#complete-circuit-written-in-vampir">Complete Circuit Written in Vampir</a></h3>
<pre><code>/* --- subset of standard aliases included in vampir --- */

// constrains a != 0
// requires the prover to give a number `x` which 
//   is a multiplicative inverse for a

def nonzero a {
    0 = 1 - a*x
}

// b = (a == 0)
// gives a boolean `b` which is 1 if `a` is 0, or is 0 if `a` is nonzero
// constrains (a, b) to be in {(0, 1), (nonzero, 0)}

def is a -&gt; b {
    0 = a*b
    0 = (nonzero a)*(1 - b)
}

/* ------ preamble with user-defined aliases ------ */

// checks that `a` and `b` are coprime using Bezout's Identity
def coprime a b {
    0 = a*x + b*y - 1 
}

/* ------------------ the circuit ----------------- */

pub count
count = (is (coprime x1 x2)) + (is (coprime x1 x3))
      + (is (coprime x1 x4)) + (is (coprime x2 x3))
      + (is (coprime x2 x4)) + (is (coprime x3 x4))
</code></pre>
<p>This particular circuit can be compiled into any backend library implementing any proof system that can handle arbitrary arithmetic circuits, provided it is translated into the appropriate constraint system. As this circuit is based entirely on polynomial expressions it can be expanded into this system of polynomial constraints by adding auxilary variables:</p>
<pre><code>0 = (x1*x6 + x2*x7 - 1) * x9
0 = (1 - (x1*x6 + x2*x7 - 1)*x8)*(1 - x9)
0 = (x1*x10 + x2*x11 - 1) * x13
0 = (1 - (x1*x10 + x2*x11 - 1)*x12)*(1 - x13)
0 = (x1*x14 + x2*x15 - 1) * x17
0 = (1 - (x1*x14 + x2*x15 - 1)*x16)*(1 - x17)
0 = (x1*x18 + x2*x19 - 1) * x21
0 = (1 - (x1*x18 + x2*x19 - 1)*x20)*(1 - x21)
0 = (x1*x22 + x2*x23 - 1) * x25
0 = (1 - (x1*x22 + x2*x23 - 1)*x24)*(1 - x25)
0 = (x1*x26 + x2*x27 - 1) * x29
0 = (1 - (x1*x26 + x2*x27 - 1)*x28)*(1 - x29)
0 = x9 + x13 + x17 + x21 + x25 + x29 - x5
</code></pre>
<p>The circuit writer itself does not need to do this expansion.</p>
<h3 id="example-prover-runtime"><a class="header" href="#example-prover-runtime">Example Prover Runtime</a></h3>
<p>We already know what the <strong>Prover's Initial Inputs</strong> must be:</p>
<pre><code>initial_inputs = (x1, x2, x3, x4, pub x5)
</code></pre>
<p>...where <code>x1,x2,x3,x4</code> are the four private numbers being tested for coprimality and <code>x5</code> is the public token claim. </p>
<p>For a Prover to create a proof for this circuit it needs to provide all the internal wire values for each gate. (For instance, the <code>x</code> and <code>y</code> in each <code>coprime</code> gate.) The Prover's initial inputs <code>(x1, x2, x3, x4, x5)</code> will be expanded into a much larger list of witnesses.</p>
<p>The Prover first provides their values for these variables. In this example the Prover will provide <code>(2, 3, 4, 7, 5)</code>. (Since 2 and 4 are not coprime there are only 5 coprime pairs to claim.)</p>
<p>So we can start with this initial <strong>witness map</strong>:</p>
<pre><code>{
    &quot;x1&quot;: 2,
    &quot;x2&quot;: 3,
    &quot;x3&quot;: 4,
    &quot;x4&quot;: 7,
}
</code></pre>
<p>Since <code>x5</code> is public it will be put into its own <strong>public input map</strong>:</p>
<pre><code>{
    &quot;x5&quot;: 5,
}
</code></pre>
<p>Then the Prover walks the gates of the circuit and computes the required extra values.</p>
<p>We start with <code>(is (coprime 2 3))</code> which expands to:</p>
<pre><code>    0 = (coprime 2 3) * b
    0 = (nonzero (coprime 2 3))*(1 - b)
</code></pre>
<p>For <code>(coprime 2 3)</code> we need to compute <code>x</code> and <code>y</code> such that <code>2x+3y-1=0</code>. There is more than one pair <code>(x, y)</code> which works, but the easiest is <code>x=-1, y=1</code>. So we rename the variables and append them to the witness map:</p>
<pre><code>{
    &quot;x6&quot;: -1,
    &quot;x7&quot;: 1,
}
</code></pre>
<p>Then <code>(is (coprime 2 3))</code> can be regarded as <code>(is 0)</code>, which expands to:</p>
<pre><code>// (is 0)

    0 = 0*b
    0 = (nonzero 0)*(1 - b)
</code></pre>
<p>Then <code>(nonzero 0)</code> itself expands to:</p>
<pre><code>// (nonzero 0)

    0 = 1 - 0*x
</code></pre>
<p>The auxilary variable <code>x</code> needs to be the multiplicative inverse of 0 which doesn't exist, so we will have to choose some other value for it, say, 0. (This will not cause the circuit to fail to verify because of the &quot;or&quot; like operation <code>(nonzero 0)*(1 - b)</code> in <code>is</code> which allows for <code>b</code> to be 1 in this case.)</p>
<p>We append to the witness map:</p>
<pre><code>{
    &quot;x8&quot;:0,
}
</code></pre>
<p>Now <code>(is (coprime 2 3))</code> has been reduced further to:</p>
<pre><code>// (is 0)

    0 = 0 * b
    0 = 1*(1 - b)
</code></pre>
<p>So all we have left is to compute the value of <code>b</code> that satisfies, which is 1, and append to the witness map:</p>
<pre><code>{
    &quot;x9&quot;:1,
}
</code></pre>
<p>Repeating this process we end up with this witness map:</p>
<pre><code>/*            witness map            */
{
	&quot;x1&quot;: 2,
	&quot;x2&quot;: 3,
	&quot;x3&quot;: 4,	
	&quot;x4&quot;: 7,
	&quot;x6&quot;: -1,
	&quot;x7&quot;: 1,
	&quot;x8&quot;: 0,
	&quot;x9&quot;: 1,
	&quot;x10&quot;: 0,
	&quot;x11&quot;: 0,
	&quot;x12&quot;: -1,
	&quot;x13&quot;: 0,
	&quot;x14&quot;: 4,
	&quot;x15&quot;: -1,
	&quot;x16&quot;: 0,
	&quot;x17&quot;: 1,
	&quot;x18&quot;: -1,
	&quot;x19&quot;: 1,
	&quot;x20&quot;: 0,
	&quot;x21&quot;: 1,
	&quot;x22&quot;: -2,
	&quot;x23&quot;: 1,
	&quot;x24&quot;: 0,
	&quot;x25&quot;: 1,
	&quot;x26&quot;: 2,
	&quot;x27&quot;: -1,
	&quot;x28&quot;: 0,
	&quot;x29&quot;: 1,
}
</code></pre>
<p>The Prover takes the witness map, the public input map, the circuit written in Vampir, and any necessary backend parameters to the Vampir backend compiler which can produce a proof.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="compilation-flow"><a class="header" href="#compilation-flow">Compilation Flow</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p><img src="architecture/j1/vampir/./diagrams/overview.svg" alt="" /></p>
<h2 id="detail-of-juvix---vampir-compilation"><a class="header" href="#detail-of-juvix---vampir-compilation">Detail of Juvix -&gt; Vampir Compilation</a></h2>
<p><img src="architecture/j1/vampir/./diagrams/juvix_vampir.svg" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="example-testcircuit-in-ir"><a class="header" href="#example-testcircuit-in-ir">Example: TestCircuit in IR</a></h1>
<p>We describe how the full workflow working with the test circuit given in
<a href="architecture/j1/vampir/../plonk-core/src/circuit.rs#L465">circuit.rs:465</a>.</p>
<p>First, the IR file is as follows.</p>
<pre><code>// circuit.pir
range[2^6] a
range[2^5] b
pub c = a + b
pub d = a * b
pub f = (fixed_base_scalar_mul e)
</code></pre>
<p>Above, we have to use &quot;(...)&quot; to force a gate expression in the current grammar
since it is vague to the parser what is a gate vs what is a poly.</p>
<p>Note that the base for the gate <code>fixed_base_scalar_mul</code> is fixed to be
<code>generator</code> by the backend, where</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let (x, y) = P::AFFINE_GENERATOR_COEFFS;
let generator = GroupAffine::new(x, y);
<span class="boring">}
</span></code></pre></pre>
<h2 id="compile"><a class="header" href="#compile">Compile</a></h2>
<p>To compile, we can run</p>
<pre><code>pir compile circuit.pir -op circuit.prover.bin -ov circuit.verifier.bin
</code></pre>
<p>The two binary files stores the necessary data and metadata for the prover and
the verifier.</p>
<h3 id="output-wires"><a class="header" href="#output-wires">Output wires</a></h3>
<p>During compilation, the backend should realize that wires <code>c</code>, <code>d</code>, <code>f</code> are
<strong>output</strong> wires, meaning they are derivable given values of <code>a</code>, <code>b</code>, <code>e</code>.</p>
<h2 id="proof-generation"><a class="header" href="#proof-generation">Proof generation</a></h2>
<p>Since the only non-output wires are <code>a</code>, <code>b</code>, <code>e</code>, one should be able to
generate a proof by specifying the following two JSON files.</p>
<p>The public input table <code>PI.json</code> is actually empty, since all public wires are
output wires and can be computed by the backend during prover runtime.</p>
<pre><code>// PI-prover.json
{}
</code></pre>
<p>The witness input table <code>W.json</code> contain values for <code>a</code>, <code>b</code>, and <code>e</code>.</p>
<pre><code>// W.json
{
  &quot;a&quot;: 20,
  &quot;b&quot;: 5,
  &quot;e&quot;: 2
}
</code></pre>
<p>To generate a proof, we run</p>
<pre><code>pir proof circuit.prover.bin PI W --proof proof.bin --PI PI-verifier.json
</code></pre>
<p>The above command should (1) generate a binary file containing the Plonk proof
and (2) generate a table <code>pubout.json</code>.</p>
<p>Table <code>PI-verifier.json</code> should now contain the computed values of <code>c</code>, <code>d</code>, <code>f</code>.</p>
<pre><code>// PI-verifier.json, after proof generation
{
  &quot;c&quot;: 25,
  &quot;d&quot;: 100,
  &quot;f&quot;: .. // representation of the group element 2 * g, where g is the fixed base
}
</code></pre>
<h2 id="proof-verification"><a class="header" href="#proof-verification">Proof verification</a></h2>
<p>To verify a proof, we can run the following command to determine the validity of
a proof.</p>
<pre><code>pir verify circuit.verifier.bin PI-verifier.json proof.bin
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="assets/mermaid.min.js"></script>
        <script type="text/javascript" src="assets/mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
