<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RPC - Anoma Specifications</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../assets/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../index.html"><strong aria-hidden="true">1.</strong> Index</a></li><li class="chapter-item expanded "><a href="../../../motivation.html"><strong aria-hidden="true">2.</strong> Motivation</a></li><li class="chapter-item expanded "><a href="../../../releases.html"><strong aria-hidden="true">3.</strong> Releases</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../releases/v1.html"><strong aria-hidden="true">3.1.</strong> V1</a></li><li class="chapter-item "><a href="../../../releases/v2.html"><strong aria-hidden="true">3.2.</strong> V2</a></li><li class="chapter-item "><a href="../../../releases/v3.html"><strong aria-hidden="true">3.3.</strong> V3</a></li></ol></li><li class="chapter-item expanded "><a href="../../../architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../architecture/clients.html"><strong aria-hidden="true">4.1.</strong> Clients</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../architecture/clients/web-wallet.html"><strong aria-hidden="true">4.1.1.</strong> Web Wallet</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/clients/web-wallet/ibc.html"><strong aria-hidden="true">4.1.1.1.</strong> IBC</a></li><li class="chapter-item "><a href="../../../architecture/clients/web-wallet/client-application.html"><strong aria-hidden="true">4.1.1.2.</strong> Client Application</a></li><li class="chapter-item "><a href="../../../architecture/clients/web-wallet/key-derivation.html"><strong aria-hidden="true">4.1.1.3.</strong> Key Derivation</a></li><li class="chapter-item "><a href="../../../architecture/clients/web-wallet/persistence.html"><strong aria-hidden="true">4.1.1.4.</strong> Persistence</a></li><li class="chapter-item expanded "><a href="../../../architecture/clients/web-wallet/rpc.html" class="active"><strong aria-hidden="true">4.1.1.5.</strong> RPC</a></li><li class="chapter-item "><a href="../../../architecture/clients/web-wallet/transparent-transactions.html"><strong aria-hidden="true">4.1.1.6.</strong> Transparent Transactions</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/clients/explorer.html"><strong aria-hidden="true">4.1.2.</strong> Explorer</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/consensus.html"><strong aria-hidden="true">4.2.</strong> Consensus</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/consensus/ferveo.html"><strong aria-hidden="true">4.2.1.</strong> Ferveo</a></li><li class="chapter-item "><a href="../../../architecture/consensus/typhon.html"><strong aria-hidden="true">4.2.2.</strong> Typhon</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/consensus/typhon/mempool.html"><strong aria-hidden="true">4.2.2.1.</strong> Mempool</a></li><li class="chapter-item "><a href="../../../architecture/consensus/typhon/heterogeneous_paxos.html"><strong aria-hidden="true">4.2.2.2.</strong> Heterogeneous Paxos</a></li><li class="chapter-item "><a href="../../../architecture/consensus/typhon/execution.html"><strong aria-hidden="true">4.2.2.3.</strong> Execution Engine</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/consensus/tendermint.html"><strong aria-hidden="true">4.2.3.</strong> Tendermint</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/economics.html"><strong aria-hidden="true">4.3.</strong> Economics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/economics/proof-of-stake.html"><strong aria-hidden="true">4.3.1.</strong> Proof-of-stake</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/economics/proof-of-stake/bonding-mechanism.html"><strong aria-hidden="true">4.3.1.1.</strong> Bonding mechanism</a></li><li class="chapter-item "><a href="../../../architecture/economics/proof-of-stake/cubic-slashing.html"><strong aria-hidden="true">4.3.1.2.</strong> Cubic slashing</a></li><li class="chapter-item "><a href="../../../architecture/economics/proof-of-stake/reward-distribution.html"><strong aria-hidden="true">4.3.1.3.</strong> Reward distribution</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/economics/inflation-system.html"><strong aria-hidden="true">4.3.2.</strong> Inflation system</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/gossip.html"><strong aria-hidden="true">4.4.</strong> Gossip</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/gossip/intent-gossip-system.html"><strong aria-hidden="true">4.4.1.</strong> Intent gossip system</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/governance.html"><strong aria-hidden="true">4.5.</strong> Governance</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/governance/signaling.html"><strong aria-hidden="true">4.5.1.</strong> Signaling</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/identity.html"><strong aria-hidden="true">4.6.</strong> Identity</a></li><li class="chapter-item "><a href="../../../architecture/interoperability.html"><strong aria-hidden="true">4.7.</strong> Interoperability</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/interoperability/ibc.html"><strong aria-hidden="true">4.7.1.</strong> IBC</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/interoperability/ibc/message.html"><strong aria-hidden="true">4.7.1.1.</strong> Messages</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/interoperability/ethereum-bridge.html"><strong aria-hidden="true">4.7.2.</strong> Ethereum bridge</a></li><li class="chapter-item "><a href="../../../architecture/interoperability/external-integrations.html"><strong aria-hidden="true">4.7.3.</strong> External integrations</a></li><li class="chapter-item "><a href="../../../architecture/interoperability/private-bridges.html"><strong aria-hidden="true">4.7.4.</strong> Private bridges</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/language.html"><strong aria-hidden="true">4.8.</strong> Language</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/language/j-group.html"><strong aria-hidden="true">4.8.1.</strong> J-group</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/language/j-group/vampir/vampir.html"><strong aria-hidden="true">4.8.1.1.</strong> Vampir</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/language/j-group/vampir/ir_design.html"><strong aria-hidden="true">4.8.1.1.1.</strong> Design Philosophy</a></li><li class="chapter-item "><a href="../../../architecture/language/j-group/vampir/ir_spec.html"><strong aria-hidden="true">4.8.1.1.2.</strong> Spec (Working Draft)</a></li><li class="chapter-item "><a href="../../../architecture/language/j-group/vampir/juvix-to-vampir.html"><strong aria-hidden="true">4.8.1.1.3.</strong> Juvix -&gt; Vampir Details</a></li><li class="chapter-item "><a href="../../../architecture/language/j-group/vampir/compilation_diagrams.html"><strong aria-hidden="true">4.8.1.1.4.</strong> Diagrams</a></li><li class="chapter-item "><a href="../../../architecture/language/j-group/vampir/examples.html"><strong aria-hidden="true">4.8.1.1.5.</strong> TestCircuit Example</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../../architecture/ledger.html"><strong aria-hidden="true">4.9.</strong> Ledger</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/ledger/fee-system.html"><strong aria-hidden="true">4.9.1.</strong> Fee system</a></li><li class="chapter-item "><a href="../../../architecture/ledger/transparent-execution.html"><strong aria-hidden="true">4.9.2.</strong> Transparent execution</a></li><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution.html"><strong aria-hidden="true">4.9.3.</strong> Shielded execution</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution/masp.html"><strong aria-hidden="true">4.9.3.1.</strong> Multi-asset shielded pool</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution/trusted-setup.html"><strong aria-hidden="true">4.9.3.1.1.</strong> Trusted setup</a></li><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution/masp/ledger-integration.html"><strong aria-hidden="true">4.9.3.1.2.</strong> Ledger integration</a></li><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution/masp/shielded-pool-incentives.html"><strong aria-hidden="true">4.9.3.1.3.</strong> Shielded pool incentives</a></li><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution/masp/burn-and-mint.html"><strong aria-hidden="true">4.9.3.1.4.</strong> Burn and mint</a></li><li class="chapter-item "><a href="../../../architecture/ledger/shielded-execution/masp/convert-circuit.html"><strong aria-hidden="true">4.9.3.1.5.</strong> Convert circuit</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../../architecture/matchmaking.html"><strong aria-hidden="true">4.10.</strong> Matchmaking</a></li><li class="chapter-item "><a href="../../../architecture/state.html"><strong aria-hidden="true">4.11.</strong> State</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anoma Specifications</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/anoma/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/anoma/specs/edit/master/src/architecture/clients/web-wallet/rpc.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h2 id="using-json-rpc-to-communicate-with-ledger"><a class="header" href="#using-json-rpc-to-communicate-with-ledger">Using JSON RPC to Communicate with Ledger</a></h2>
<p>To query values from the ledger, the web-wallet must issue JSON RPC calls to the <strong>Tendermint</strong> <code>abci_query</code> endpoint over HTTP, which if running the ledger locally, would look like:</p>
<pre><code>http://localhost:26657/abci_query/
</code></pre>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">imi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">nb</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">co</span><span class="mord mathnormal">mm</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">ero</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal">soc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">an</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">‘‘‘</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">//</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oc</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">h</span><span class="mord mathnormal">os</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">26657/</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal">soc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">/‘‘‘</span></span></span></span></span>
To handle this in the wallet, we can make use of existing functionality from <code>cosmjs</code>, namely, the <code>RpcClient</code> and <code>WebsocketClient</code>.</p>
<h3 id="rpc-http-client"><a class="header" href="#rpc-http-client">RPC HTTP Client</a></h3>
<p>Over HTTP, using the <code>abci_query</code> endpoint, we can query the ledger by providing a <code>path</code> to the storage value we wish to query. Here are some examples:</p>
<ul>
<li>Query balance: <code>value/#{token_address}/balance/#{owner_address}</code></li>
<li>Query epoch: <code>epoch</code></li>
<li>Is known address?: <code>has_key/#{address}/?</code></li>
</ul>
<p>There are many other types of queries in addition to <code>abci_query</code> that can be issued to Tendermint. See <a href="https://docs.tendermint.com/master/rpc/">https://docs.tendermint.com/master/rpc/</a> for more information.</p>
<h3 id="websocket-client"><a class="header" href="#websocket-client">WebSocket Client</a></h3>
<p>The most interesting type of interaction with the ledger thus far is via WebSockets. The goal of the implementation in <code>anoma-wallet</code> is to allow us to provide listeners so that we can update the React app according to activity on the ledger. The core functionality of the implementation on the client is as follows:</p>
<pre><code class="language-ts">public async broadcastTx(
  hash: string,
  tx: Uint8Array,
  { onBroadcast, onNext, onError, onComplete }: SubscriptionParams
): Promise&lt;SocketClient&gt; {
  if (!this._client) {
    this.connect();
  }

  try {
    const queries = [`tm.event='NewBlock'`, `{TxResponse.Hash}='{hash}'`];
    this.client
      ?.execute(
        createJsonRpcRequest(&quot;broadcast_tx_sync&quot;, { tx: toBase64(tx) })
      )
      .then(onBroadcast)
      .catch(onError);

    this.client
      ?.listen(
        createJsonRpcRequest(&quot;subscribe&quot;, {
          query: queries.join(&quot; AND &quot;),
        })
      )
      .addListener({
        next: onNext,
        error: onError,
        complete: onComplete,
      });

    return Promise.resolve(this);
  } catch (e) {
    return Promise.reject(e);
  }
}
</code></pre>
<p>There are a few key things happening here. Once we have constructed a transaction, we receive a transaction <code>hash</code> and a <code>Uint8Array</code> containing the bytes of the wrapped and signed transaction. We first execute the request to <code>broadcast_tx_sync</code>, which can take an <code>onBroadcast</code> callback from the client to listen to the initial response from the ledger. We provide the <code>tx</code> data in <code>base64</code> format as an argument.</p>
<p>Following that, we subcribe to events on the ledger using a query containing <code>tm.event='NewBlock' AND applied.hash='transaction_hash_value'</code>, then then register the following listeners so that we may trigger activity in the front-end app:</p>
<ul>
<li><code>onNext</code> - called when we receive a <code>NewBlock</code> event that matches our <code>hash</code></li>
<li><code>onError</code> - called in the event of an error</li>
<li><code>onComplete</code> - called when the websocket closes</li>
</ul>
<p>The way this library in <code>anoma-wallet/src/lib/</code> is implemented, we can also determine when we want to disconnect the WebSocket. For instance, if for some reason we want to issue a series of transactions in succession, we could feasibly leave the connection open, then close after the final transaction is complete. Alternatively, and in most cases, we would simply close the connection when we are finished with a single transaction, which would then trigger the <code>onComplete</code> callback.</p>
<p>See <a href="./transparent-transactions.html">Transparent Transactions</a> for more information on how the transactions are initially constructed.</p>
<pre><code></code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../architecture/clients/web-wallet/persistence.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../architecture/clients/web-wallet/transparent-transactions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../architecture/clients/web-wallet/persistence.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../architecture/clients/web-wallet/transparent-transactions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../../assets/mermaid.min.js"></script>
        <script type="text/javascript" src="../../../assets/mermaid-init.js"></script>


    </body>
</html>
