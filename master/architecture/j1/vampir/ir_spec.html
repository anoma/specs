<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Spec (Working Draft) - Anoma Specification</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../assets/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../index.html"><strong aria-hidden="true">1.</strong> Index</a></li><li class="chapter-item expanded "><a href="../../../motivation.html"><strong aria-hidden="true">2.</strong> Motivation</a></li><li class="chapter-item expanded "><a href="../../../architecture.html"><strong aria-hidden="true">3.</strong> Architecture</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/namada.html"><strong aria-hidden="true">3.1.</strong> Namada</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/namada/consensus.html"><strong aria-hidden="true">3.1.1.</strong> Consensus</a></li><li class="chapter-item "><a href="../../../architecture/namada/p2p.html"><strong aria-hidden="true">3.1.2.</strong> P2P layer</a></li><li class="chapter-item "><a href="../../../architecture/namada/execution-system.html"><strong aria-hidden="true">3.1.3.</strong> Execution system</a></li><li class="chapter-item "><a href="../../../architecture/namada/masp.html"><strong aria-hidden="true">3.1.4.</strong> Multi-asset shielded pool</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/namada/masp/trusted-setup.html"><strong aria-hidden="true">3.1.4.1.</strong> Trusted setup</a></li><li class="chapter-item "><a href="../../../architecture/namada/masp/ledger-integration.html"><strong aria-hidden="true">3.1.4.2.</strong> Ledger integration</a></li><li class="chapter-item "><a href="../../../architecture/namada/masp/shielded-pool-incentives.html"><strong aria-hidden="true">3.1.4.3.</strong> Shielded pool incentives</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/namada/governance.html"><strong aria-hidden="true">3.1.5.</strong> Governance</a></li><li class="chapter-item "><a href="../../../architecture/namada/proof-of-stake.html"><strong aria-hidden="true">3.1.6.</strong> Proof of stake</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/namada/proof-of-stake/bonding-mechanism.html"><strong aria-hidden="true">3.1.6.1.</strong> Bonding mechanism</a></li><li class="chapter-item "><a href="../../../architecture/namada/proof-of-stake/cubic-slashing.html"><strong aria-hidden="true">3.1.6.2.</strong> Cubic slashing</a></li><li class="chapter-item "><a href="../../../architecture/namada/proof-of-stake/reward-distribution.html"><strong aria-hidden="true">3.1.6.3.</strong> Reward distribution</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/namada/inflation-system.html"><strong aria-hidden="true">3.1.7.</strong> Inflation system</a></li><li class="chapter-item "><a href="../../../architecture/namada/fee-system.html"><strong aria-hidden="true">3.1.8.</strong> Fee system</a></li><li class="chapter-item "><a href="../../../architecture/namada/ibc.html"><strong aria-hidden="true">3.1.9.</strong> IBC integration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/namada/ibc/message.html"><strong aria-hidden="true">3.1.9.1.</strong> Messages</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/namada/ethereum-bridge.html"><strong aria-hidden="true">3.1.10.</strong> Ethereum bridge</a></li><li class="chapter-item "><a href="../../../architecture/namada/web-wallet-interface.html"><strong aria-hidden="true">3.1.11.</strong> Web wallet interface</a></li><li class="chapter-item "><a href="../../../architecture/namada/web-explorer-interface.html"><strong aria-hidden="true">3.1.12.</strong> Web explorer interface</a></li><li class="chapter-item "><a href="../../../architecture/namada/testnets.html"><strong aria-hidden="true">3.1.13.</strong> Testnets</a></li><li class="chapter-item "><a href="../../../architecture/namada/external-integrations.html"><strong aria-hidden="true">3.1.14.</strong> External integrations</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/m2.html"><strong aria-hidden="true">3.2.</strong> M2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/m2/ferveo.html"><strong aria-hidden="true">3.2.1.</strong> Ferveo</a></li><li class="chapter-item "><a href="../../../architecture/m2/private-bridges.html"><strong aria-hidden="true">3.2.2.</strong> Private bridges</a></li></ol></li><li class="chapter-item "><a href="../../../architecture/a1.html"><strong aria-hidden="true">3.3.</strong> A1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/a1/state-architecture.html"><strong aria-hidden="true">3.3.1.</strong> State architecture</a></li><li class="chapter-item "><a href="../../../architecture/a1/intent-gossip-system.html"><strong aria-hidden="true">3.3.2.</strong> Intent gossip system</a></li><li class="chapter-item "><a href="../../../architecture/a1/matchmaking.html"><strong aria-hidden="true">3.3.3.</strong> Matchmaking</a></li><li class="chapter-item "><a href="../../../architecture/a1/typhon.html"><strong aria-hidden="true">3.3.4.</strong> Typhon</a></li><li class="chapter-item "><a href="../../../architecture/a1/private-bartering-circuits.html"><strong aria-hidden="true">3.3.5.</strong> Private bartering circuits</a></li><li class="chapter-item "><a href="../../../architecture/a1/private-execution-architecture.html"><strong aria-hidden="true">3.3.6.</strong> Private execution architecture</a></li><li class="chapter-item "><a href="../../../architecture/a1/decentralised-proof-of-identity.html"><strong aria-hidden="true">3.3.7.</strong> Decentralised proof-of-identity</a></li><li class="chapter-item "><a href="../../../architecture/a1/public-goods-funding.html"><strong aria-hidden="true">3.3.8.</strong> Public goods funding</a></li><li class="chapter-item "><a href="../../../architecture/a1/fee-system.html"><strong aria-hidden="true">3.3.9.</strong> Fee system</a></li></ol></li><li class="chapter-item expanded "><a href="../../../architecture/j1.html"><strong aria-hidden="true">3.4.</strong> J1</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../architecture/j1/vampir/vampir.html"><strong aria-hidden="true">3.4.1.</strong> Vampir</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../architecture/j1/vampir/ir_design.html"><strong aria-hidden="true">3.4.1.1.</strong> Design Philosophy</a></li><li class="chapter-item expanded "><a href="../../../architecture/j1/vampir/ir_spec.html" class="active"><strong aria-hidden="true">3.4.1.2.</strong> Spec (Working Draft)</a></li><li class="chapter-item "><a href="../../../architecture/j1/vampir/juvix-to-vampir.html"><strong aria-hidden="true">3.4.1.3.</strong> Juvix -&gt; Vampir Details</a></li><li class="chapter-item "><a href="../../../architecture/j1/vampir/compilation_diagrams.html"><strong aria-hidden="true">3.4.1.4.</strong> Diagrams</a></li><li class="chapter-item "><a href="../../../architecture/j1/vampir/examples.html"><strong aria-hidden="true">3.4.1.5.</strong> TestCircuit Example</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anoma Specification</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ir-spec-working-draft"><a class="header" href="#ir-spec-working-draft">IR Spec Working Draft</a></h1>
<p>There are two possible approaches to naming: (1) constraint systems,
constraints, and variables, or (2) circuits, gates, and wires. Since <code>plonk</code> is
a proof system for zero-knowledge <em>circuits</em>, we stick with circuit-based
terminology.</p>
<h2 id="wires"><a class="header" href="#wires">Wires</a></h2>
<ul>
<li>A wire is a fundamental, atomic, immutable representation of data.</li>
<li>Name: names of wires are strings that start with a letter, and can include underscores and digit characters.</li>
<li>They are allocated at compile time as they appear.</li>
<li>All wires are assigned values in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> (either at compile-time or at prover / verifier run-time), where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> is a globally fixed (usually ~256-bit) prime. TODO: should we add <code>#pragma</code> declarations for specifying <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>?</li>
</ul>
<h3 id="public-wires"><a class="header" href="#public-wires">Public wires</a></h3>
<p>Public wires are public inputs into the circuit that are not known at compile-time. To allocate the variable <code>contract_public_key</code> as public we simply declare it in the following statement:</p>
<pre><code>pub contract_public_key
</code></pre>
<p>The variable <code>contract_public_key</code> can then be used in a polynomial constraint like any other variable. Alternatively, one can declare a wire to be public by adding the keyword <code>pub</code> when referring to the wire.</p>
<h3 id="private-wires"><a class="header" href="#private-wires">Private wires</a></h3>
<p>Private wires are the Prover's secret witnesses. Any variable not explicitly made public is a private wire.</p>
<h3 id="named-vs-unnamed-wires"><a class="header" href="#named-vs-unnamed-wires">Named vs. unnamed wires</a></h3>
<p>Some wires are implicitly created and can be unnamed from the perspective of the IR.</p>
<h2 id="constants-aka-scalars"><a class="header" href="#constants-aka-scalars">Constants (a.k.a scalars)</a></h2>
<p>Fixed constants are strings of digits that are interpreted as decimal integers. They can be preceded by a &quot;-&quot; to indicate that they are negative.</p>
<h2 id="expressions"><a class="header" href="#expressions">Expressions</a></h2>
<p>An expression is any code block that returns one or more values encoded in unnamed wires.</p>
<h3 id="polynomial-expressions"><a class="header" href="#polynomial-expressions">Polynomial Expressions</a></h3>
<p>Polynomial expressions are algebraic expressions involving of wires and
constants (&quot;multi-variable&quot; polynomial where wires are &quot;variables&quot;). Below are
two polynomial expressions.</p>
<pre><code>x^2 - 1
x^2 + y^2 - z^2
</code></pre>
<p>The polynomial ought to be expressed in a standard format that can easily be plugged into polynomial solvers and other tools.</p>
<h3 id="gate-expressions"><a class="header" href="#gate-expressions">Gate expressions</a></h3>
<p>Some gates provide output wires. It forms an expression when they are called without output wires in the arguments. For example, <code>add x 1</code>, <code>mul x y</code>.</p>
<h2 id="constraint-statements"><a class="header" href="#constraint-statements">Constraint statements</a></h2>
<p>A constraint statement constrains a set of wires. Named and unnamed internal
wires can be created as a consequence of a constraint statement. There are two
types of constraint statements, equality statements and gate statements.</p>
<h3 id="equality-statement"><a class="header" href="#equality-statement">Equality statement</a></h3>
<p>An equality statement constrains two expressions (left- and right-hand side) to be equal to each other.</p>
<p>Here is an equality statement for checking if three inputs form a Pythagorean triple:</p>
<pre><code>0 = x^2 + y^2 - z^2
</code></pre>
<p>This gate represents a constraint. That is, this gate constrains the polynomial indicated to equal zero. The variables used in the polynomial that have not already been used earlier will be allocated when the polynomial is processed.</p>
<p>It is convenient sometimes to think of a polynomial expression as an &quot;assignment&quot;. We can achieve this by allowing polynomial constraints to be written as an equation with a left and right side. These two polynomials are equivalent:</p>
<pre><code>x_1^3 - 5x_2^2 - x_3
x_3 = x_1^3 - 5x_2^2
</code></pre>
<p>Since this is not <em>true</em> assignment, but merely a constraint, it is also valid to &quot;assign&quot; to scalars. These are equivalent:</p>
<pre><code>0 = x_1 * x_2 - 42
42 = x_1 * x_2
</code></pre>
<p>Equality statements involving general expressions are compiled down to gate statements by the backend.</p>
<h3 id="gate-statement"><a class="header" href="#gate-statement">Gate statement</a></h3>
<p>A gate constraint is formed when a gate is called with all input and output wires.</p>
<pre><code>bool x
bool x * y
</code></pre>
<h2 id="alias-statement"><a class="header" href="#alias-statement">Alias statement</a></h2>
<p>An alias can be given to sets of constraint statements that are used often. Curly braces are used to indicate a set of constraints.</p>
<pre><code>// definition of my_alias
def my_alias input_wires... -&gt; output_wires... {
	constraint_statement_1
	constraint_statement_2

	.
	.
}

// calling my_alias can be done like this:
my_alias input_1 input_2 ... output_1 output_2 ...

// or like this:
output_1 output_2 ... = my_alias input_1 input_2 ...
// this is technically an equality statement where the rhs is a gate expression
</code></pre>
<p>In arithmetic constraints there really is no distinction between inputs and outputs. We make the distinction here to tell the backend compiler how to interpret a constraint written in &quot;assignment&quot; mode and how to compose constraints.</p>
<p>Since aliased subcircuits are likely to be used more than once, a backend compiler may decide to replace an aliased subcircuit with a lookup gate or custom gate if it has those features available.</p>
<p>Often times, the gates supported by the backend are not agnostic to the wire types. To build alias gates for these built-in gates, one needs to declare the required wire types in the alias definition. For example:</p>
<pre><code>def eq (priv x) -&gt; (priv y) {
  y = poly_gate[0 1 0 -1 0] x x
}

def eq (priv x) -&gt; (pub y) {
  y = pubout_poly_gate[0 1 0 0 0] x x x
}

def eq (priv x) -&gt; (const y) {
  poly_gate[0 1 0 0 y] x x x
}
</code></pre>
<p><a href="./tests/arithmetic_aliases.pir">More examples</a>.</p>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<h4 id="no-output-gate"><a class="header" href="#no-output-gate">No-output Gate</a></h4>
<p>A range gate is a commonly used gate that does not have a canonical output. A 2-bit range gate would be defined and called like this:</p>
<pre><code>// definition
def range_2 x {
	b_0 = b_0^2
	b_1 = b_1^2
	x = 2b_1 + b_0
}

// call
range_2 x
</code></pre>
<p>The variable <code>x</code> is now constrained to be 0, 1, 2, or 3.</p>
<p>Because the gate is defined with no outputs, trying to call it like this should produce an error:</p>
<pre><code>// invalid
y = range_2 x

// also invalid
x = range_2
</code></pre>
<h4 id="single-output-gate"><a class="header" href="#single-output-gate">Single-output Gate</a></h4>
<pre><code>// definition
add x y -&gt; z = { poly x + y - z}

// call
add x y z

// or
z = add x y
</code></pre>
<h4 id="multiple-outputs"><a class="header" href="#multiple-outputs">Multiple Outputs</a></h4>
<p>Aliased gates can give multiple outputs. Suppose we want to do integer division between two variables and want both the quotient and remainder as outputs (like <code>divmod</code> in Python).</p>
<pre><code>def divmod x y -&gt; q r { .... }

// then divmod can be called like this
divmod x y q r

// or this
q r = divmod x y
</code></pre>
<h4 id="composing-gates"><a class="header" href="#composing-gates">Composing Gates</a></h4>
<p>Gates can be composed using assignment mode or prefix mode.</p>
<pre><code>// definition
def curve_add x1 y1 x2 y2 -&gt; x3 y3 { ... }

// assignment mode definition
def curve_add_four x1 y1 x2 y2 x3 y3 x4 y4 -&gt; x5 y5 {
	mx1 my1 = curve_add x1 y1 x2 y2
	mx2 my2 = curve_add x3 y3 x4 y4
	x5 y5 = curve_add mx1 my1 mx2 my2
}

// prefix mode definition
def curve_add_four x1 y1 x2 y2 x3 y3 x4 y4 -&gt; x5 y5 {
	curve_add (curve_add x1 y1 x2 y2) (curve_add x3 y3 x4 y4)
}
</code></pre>
<h2 id="a-partial-list-of-built-in-gates-and-some-of-their-definitions-in-terms-of-polynomial-gates"><a class="header" href="#a-partial-list-of-built-in-gates-and-some-of-their-definitions-in-terms-of-polynomial-gates">A Partial List of Built-in Gates and (some of) their Definitions in Terms of Polynomial Gates</a></h2>
<pre><code>// x + y = z
def add x y -&gt; z { poly x + y - z }

// x - y = z
def sub x y -&gt; z { poly x - y - z }

// x*y = z
def mul x y -&gt; z { poly x * y - z }

// inv x = x_inv
def inv x -&gt; x_inv
// if x is 0, then x_inv is set to 0

// x &lt; y
def less x y { ... }

// x = r mod q
def mod x q -&gt; r { ... }

// bit decomp of x
def bits x -&gt; b_0 ... b_k { ... }

// bit pack of b_0 ... b_k
def bitpack b_0 ... b_k -&gt; x { bits x b_0 ... b_k }

// k = bit count of x
def bitcount x -&gt; k { ... }

// x a bool
def bool x {range_1 x}

// x &lt; 2^k 		k is an usize
def bit_range[k] x { ... }

// conditional / controlled selects
// out = opt_bit
def cselect bit opt_0 opt_1 -&gt; out
// bit = 1 =&gt; out = val / bit = 0 =&gt; out = 1
def cselect_1 bit val -&gt; out
// bit = 1 =&gt; out = 1 / bit = 0 =&gt; out = val
def cselect_0 bit val -&gt; out

// k-bit xor and
def xor[k] x y -&gt; z { ... }
def and[k] x y -&gt; z { ... }

// Twister Edwards curve addition
def variable_base_add x1 y1 x2 y3 -&gt; x3 y3
def fixed_base_add ...

// scalar mul potentially defined as internal alias using point addition and
bit decomposition
def variable_base_mul scalar x1 y1 -&gt; x2 y2
def fixed_base_mul scalar -&gt; x2 y2

// Blake2s(x) = y
def blake2s x .. -&gt; y { ... }

// Blake2b(x) = y
def blake2b x .. -&gt; y { ... }

// SHA-256(x) = y
def sha256 x .. -&gt; y { ... }

etc.
</code></pre>
<h3 id="built-in-gates-and-output-wires"><a class="header" href="#built-in-gates-and-output-wires">Built-in gates and output wires</a></h3>
<p>For built-in gates, we insist the backend to know how output wires are computed
given all the input wires. As a result, when generating a proof, output wires
of built-in gates need not be specified.</p>
<h2 id="prover-and-verifier-run-time-input-specification"><a class="header" href="#prover-and-verifier-run-time-input-specification">Prover and verifier run-time input specification</a></h2>
<p>To generate a proof, we need to provide a file specifying a circuit (or compiled
output from it), as well as (1) a table <code>PI</code> mapping all public wires
to their values (in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>) and (2) a table <code>W</code> mapping all non-output wires to
their values (again in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>).</p>
<p>To verify a proof, we need to provide, besides the proof, a file specifying a
circuit (or compiled output from it), as well as a table <code>PI</code> (same as in proof
generation).</p>
<p>Tables <code>PI</code> and <code>W</code> are given as a JSON formatted table.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../architecture/j1/vampir/ir_design.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../architecture/j1/vampir/juvix-to-vampir.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../architecture/j1/vampir/ir_design.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../architecture/j1/vampir/juvix-to-vampir.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../../assets/mermaid.min.js"></script>
        <script type="text/javascript" src="../../../assets/mermaid-init.js"></script>


    </body>
</html>
